{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome Articles 2021-01-25 : Authenticate to SharePoint Online through an Azure Function using PnP Framework 2020-11-19 : Connect to SharePoint in an AAD Application permission context with a certificate stored in Azure KeyVault 2020-02-11 : How to quickly and properly delete a Team (without waiting) Tips & Tricks 2021-09-14 : [Azure DevOps] Get default project administrators team members programmatically 2021-03-02 : [SPFx] Init API permissions for your SPFx projects without deploying them 2020-12-04 : [SPFx] Transform the Fluent UI Breadcrumb component into a step indicator 2020-05-05 : [SPFx] Transform the Fluent UI ProgressIndicator component into a countdown timer 2020-02-13 : [CSOM] Test in your C# code if a SharePoint File or Folder exists","title":"Home"},{"location":"#welcome","text":"","title":"Welcome"},{"location":"#articles","text":"2021-01-25 : Authenticate to SharePoint Online through an Azure Function using PnP Framework 2020-11-19 : Connect to SharePoint in an AAD Application permission context with a certificate stored in Azure KeyVault 2020-02-11 : How to quickly and properly delete a Team (without waiting)","title":"Articles"},{"location":"#tips-tricks","text":"2021-09-14 : [Azure DevOps] Get default project administrators team members programmatically 2021-03-02 : [SPFx] Init API permissions for your SPFx projects without deploying them 2020-12-04 : [SPFx] Transform the Fluent UI Breadcrumb component into a step indicator 2020-05-05 : [SPFx] Transform the Fluent UI ProgressIndicator component into a countdown timer 2020-02-13 : [CSOM] Test in your C# code if a SharePoint File or Folder exists","title":"Tips &amp; Tricks"},{"location":"about/","text":"About this blog Who Am I Hi ! I'm Micha\u00ebl, Software Engineer for onepoint based in Nantes, France. I'm +10yr experienced in SharePoint solutions (started from the 2007 version) and since 2017, I'm focused on developing SPFx solutions, working with Office 365 Managed Services and Azure Services, exploring Microsoft Graph and Identity. I also (try to) contribute to the PnP Initiative with amazing people ! In this blog, I'll talk about things I learned day by day since I started to work with SharePoint Products (articles, memos,...). Why Now It's hard to convince yourself \"Ok, let's open to the world\". I think I was waiting for the right time. When I see how the Microsoft Community has grown up, especially in the Office 365 bubble, I think that it could be helpful to anyone who, like me, wants to find some answers to technical issues met (missing puzzle piece \ud83d\ude09). Why In English Because it's easier to reach out a maximum of people \ud83e\udd17 Hope you'll find what you're looking for, see you online or IRL !","title":"About"},{"location":"about/#about-this-blog","text":"","title":"About this blog"},{"location":"about/#who-am-i","text":"Hi ! I'm Micha\u00ebl, Software Engineer for onepoint based in Nantes, France. I'm +10yr experienced in SharePoint solutions (started from the 2007 version) and since 2017, I'm focused on developing SPFx solutions, working with Office 365 Managed Services and Azure Services, exploring Microsoft Graph and Identity. I also (try to) contribute to the PnP Initiative with amazing people ! In this blog, I'll talk about things I learned day by day since I started to work with SharePoint Products (articles, memos,...).","title":"Who Am I"},{"location":"about/#why-now","text":"It's hard to convince yourself \"Ok, let's open to the world\". I think I was waiting for the right time. When I see how the Microsoft Community has grown up, especially in the Office 365 bubble, I think that it could be helpful to anyone who, like me, wants to find some answers to technical issues met (missing puzzle piece \ud83d\ude09).","title":"Why Now"},{"location":"about/#why-in-english","text":"Because it's easier to reach out a maximum of people \ud83e\udd17 Hope you'll find what you're looking for, see you online or IRL !","title":"Why In English"},{"location":"articles/20200211-properly-remove-team/","text":"How to quickly and properly delete a Teams Team (without waiting) Article updates 2021-12-03 : article update following CLI for Microsoft 365 updates, adding permanent AAD Group removal and Teams team deletion (optional), adding new PnP PowerShell commands. 2020-11-29 : article update following CLI for Microsoft 365 updates, adding a new command for permanently delete a Site Collection. Use Case You work for a company that wants to automatically create a Team with Tabs, Channels and other stuff that will make a new project team ready to rock the stage. You are preparing the process and for mastering it, you have createed / tested / destroyed / retried. But when you want to clean up your mess you have to know that, during 30 days: Your Team still exists as a Group (you can find it in the \"Deleted Groups\" menu on AAD), same for the associated e-mail address The Teams site also still exists So let's says that you made a mistake during the creation of a Team and want to \"start over\" (with same name of course), if you don't want to wait for the Office 365 Job to update your environment and re-create the Team with same name: The SharePoint site URL takes a number at the end of its address (of course, because the older one's still here) You can't permanently delete the Teams site, as the SharePoint Admin Center detects that the related Group still exists Here's a step by step process to delete quickly a Team! I recommend to follow them in this order to make everything's work. Prerequisites An Office 365 (Dev) Tenant or a Partner Demo Tenant An Account with the following Office 365 roles SharePoint Admin Teams Admin An Account with the following Azure AD role Groups administrator Command Interface (one of these) PowerShell (with AzureAD PowerShell , PnP PowerShell and Microsoft Teams PowerShell ) CLI for Microsoft 365 Delete Group Delete Group with Interface Throught the UI, you have to delete the Group then permanently delete it Delete Group with code PnP PowerShell 1 2 3 4 5 6 7 8 9 # If you are familiar with the Get-PnPStoredCredential cmdlet, # you can use it here with the \"-Credential\" Argument Connect-PnPOnline -Url \"https://contoso-admin.sharepoint.com\" # Remove the Group Remove-PnPMicrosoft365Group -Identity \"GroupId\" # Remove the Group from AAD deleted groups (can take a few seconds to be reflected in the UI) Remove-PnPDeletedMicrosoft365Group -Identity \"GroupId\" CLI for Microsoft 365 1 2 m365 login m365 aad o365group remove --id \"GroupId\" --skipRecycleBin --confirm Azure AD PowerShell 1 2 3 Connect-AzureAD -TenantId \"TenantId\" Remove-AzureADGroup -ObjectId \"GroupId\" Remove-AzureADMSDeletedDirectoryObject -Id \"GroupId\" Delete Team (if necessary) Sometimes, once a Group is permanently deleted, the Team still exists. If it's the case and once again, you don't want for the Job to delete it, you can do it yourself. But don't be surprise if the following commands throw an error : maybe the Job has already worked. Delete Team with Interface Throught the UI (if you have an owner account) or Admin Interface, you can delete the Team OR Delete Team with code Warning As the AAD Group removal triggers automatically the Teams Team deletion you can skip this part. PnP PowerShell 1 2 # Remove the Team Remove-PnPTeamsTeam -Identity \"GroupId\" -Force CLI for Microsoft 365 1 2 # Remove the Team m365 teams team remove --teamId \"GroupId\" --confirm Microsoft Teams PowerShell 1 2 Connect-MicrosoftTeams -TenantId \"TenantId\" Remove-Team -GroupId \"GroupId\" Delete Site Collection As I told you before (even if you did the previous steps), if you try to delete the Teams site from the SharePoint Admin Center, you won't be able to remove it from the Site Collection Recycle Bin (because of the O365 Job Tenant update process). Delete site with code PnP PowerShell 1 2 # Remove the site Remove-PnPTenantSite -Url \"TeamsSiteUrl\" -Force -SkipRecycleBin CLI for Microsoft 365 1 2 # Remove the site m365 spo site remove -u \"TeamsSiteUrl\" --skipRecycleBin --confirm --wait That's it Et voil\u00e0 ! You can start over your process until it's ready to use. Of course, you could also make those tasks with the SharePoint Online Management Shell or with the Graph API, but here I've covered the most common ways of working with Teams / Group / SharePoint administration. Useful Links Microsoft Teams Architecture Microsoft Teams Architecture Posters","title":"How to quickly and properly delete a Teams Team (without waiting)"},{"location":"articles/20200211-properly-remove-team/#how-to-quickly-and-properly-delete-a-teams-team-without-waiting","text":"Article updates 2021-12-03 : article update following CLI for Microsoft 365 updates, adding permanent AAD Group removal and Teams team deletion (optional), adding new PnP PowerShell commands. 2020-11-29 : article update following CLI for Microsoft 365 updates, adding a new command for permanently delete a Site Collection.","title":"How to quickly and properly delete a Teams Team (without waiting)"},{"location":"articles/20200211-properly-remove-team/#use-case","text":"You work for a company that wants to automatically create a Team with Tabs, Channels and other stuff that will make a new project team ready to rock the stage. You are preparing the process and for mastering it, you have createed / tested / destroyed / retried. But when you want to clean up your mess you have to know that, during 30 days: Your Team still exists as a Group (you can find it in the \"Deleted Groups\" menu on AAD), same for the associated e-mail address The Teams site also still exists So let's says that you made a mistake during the creation of a Team and want to \"start over\" (with same name of course), if you don't want to wait for the Office 365 Job to update your environment and re-create the Team with same name: The SharePoint site URL takes a number at the end of its address (of course, because the older one's still here) You can't permanently delete the Teams site, as the SharePoint Admin Center detects that the related Group still exists Here's a step by step process to delete quickly a Team! I recommend to follow them in this order to make everything's work.","title":"Use Case"},{"location":"articles/20200211-properly-remove-team/#prerequisites","text":"An Office 365 (Dev) Tenant or a Partner Demo Tenant An Account with the following Office 365 roles SharePoint Admin Teams Admin An Account with the following Azure AD role Groups administrator Command Interface (one of these) PowerShell (with AzureAD PowerShell , PnP PowerShell and Microsoft Teams PowerShell ) CLI for Microsoft 365","title":"Prerequisites"},{"location":"articles/20200211-properly-remove-team/#delete-group","text":"","title":"Delete Group"},{"location":"articles/20200211-properly-remove-team/#delete-group-with-interface","text":"Throught the UI, you have to delete the Group then permanently delete it","title":"Delete Group with Interface"},{"location":"articles/20200211-properly-remove-team/#delete-group-with-code","text":"PnP PowerShell 1 2 3 4 5 6 7 8 9 # If you are familiar with the Get-PnPStoredCredential cmdlet, # you can use it here with the \"-Credential\" Argument Connect-PnPOnline -Url \"https://contoso-admin.sharepoint.com\" # Remove the Group Remove-PnPMicrosoft365Group -Identity \"GroupId\" # Remove the Group from AAD deleted groups (can take a few seconds to be reflected in the UI) Remove-PnPDeletedMicrosoft365Group -Identity \"GroupId\" CLI for Microsoft 365 1 2 m365 login m365 aad o365group remove --id \"GroupId\" --skipRecycleBin --confirm Azure AD PowerShell 1 2 3 Connect-AzureAD -TenantId \"TenantId\" Remove-AzureADGroup -ObjectId \"GroupId\" Remove-AzureADMSDeletedDirectoryObject -Id \"GroupId\"","title":"Delete Group with code"},{"location":"articles/20200211-properly-remove-team/#delete-team-if-necessary","text":"Sometimes, once a Group is permanently deleted, the Team still exists. If it's the case and once again, you don't want for the Job to delete it, you can do it yourself. But don't be surprise if the following commands throw an error : maybe the Job has already worked.","title":"Delete Team (if necessary)"},{"location":"articles/20200211-properly-remove-team/#delete-team-with-interface","text":"Throught the UI (if you have an owner account) or Admin Interface, you can delete the Team OR","title":"Delete Team with Interface"},{"location":"articles/20200211-properly-remove-team/#delete-team-with-code","text":"Warning As the AAD Group removal triggers automatically the Teams Team deletion you can skip this part. PnP PowerShell 1 2 # Remove the Team Remove-PnPTeamsTeam -Identity \"GroupId\" -Force CLI for Microsoft 365 1 2 # Remove the Team m365 teams team remove --teamId \"GroupId\" --confirm Microsoft Teams PowerShell 1 2 Connect-MicrosoftTeams -TenantId \"TenantId\" Remove-Team -GroupId \"GroupId\"","title":"Delete Team with code"},{"location":"articles/20200211-properly-remove-team/#delete-site-collection","text":"As I told you before (even if you did the previous steps), if you try to delete the Teams site from the SharePoint Admin Center, you won't be able to remove it from the Site Collection Recycle Bin (because of the O365 Job Tenant update process).","title":"Delete Site Collection"},{"location":"articles/20200211-properly-remove-team/#delete-site-with-code","text":"PnP PowerShell 1 2 # Remove the site Remove-PnPTenantSite -Url \"TeamsSiteUrl\" -Force -SkipRecycleBin CLI for Microsoft 365 1 2 # Remove the site m365 spo site remove -u \"TeamsSiteUrl\" --skipRecycleBin --confirm --wait","title":"Delete site with code"},{"location":"articles/20200211-properly-remove-team/#thats-it","text":"Et voil\u00e0 ! You can start over your process until it's ready to use. Of course, you could also make those tasks with the SharePoint Online Management Shell or with the Graph API, but here I've covered the most common ways of working with Teams / Group / SharePoint administration.","title":"That's it"},{"location":"articles/20200211-properly-remove-team/#useful-links","text":"Microsoft Teams Architecture Microsoft Teams Architecture Posters","title":"Useful Links"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/","text":"Connect to SharePoint in an AAD Application permission context with a certificate stored in Azure KeyVault Use Case You work on a Web Application (or API) which is connected to a SharePoint Tenant. You want to setup things correctly and want to execute SharePoint actions in Azure Active Directory (AAD) Application permission context. Goal of this article This article will show how to work with a SharePoint site through an API or a Web Application, only with AAD Application permissions. It will demonstrate how to setup everything and how to connect with a certificate stored in a Key Vault, step by step, in UI, PowerShell and Azure CLI. Let's see the final result below The Web Application (or API)... Requests access to the Key Vault, in order to get the stored certificate Gets the Key Vault certificate Authenticates to Office 365 using the SharePoint AAD Application with the certificate Gets a ClientContext with the requested API permissions Uses the ClientContext object to query the SharePoint site Gets Web info (I've shrinked the 3. because there are somes requests are made to https://login.microsofonline.com , more info here ) Prerequisites An Office 365 (Dev) Tenant or a Partner Demo Tenant An Azure subscription and the following Azure AD role at least Application Administrator Command Interface (one of these) PowerShell (with Az PowerShell and AzureAD PowerShell ) Azure CLI ( on your machine or through Azure Cloud Shell ) Visual Studio (2017 or later) Why authenticating by certificate and not by Client ID / Secret In AAD Application permission context, for unknown reason, you can't work with SharePoint REST API using Client ID / Secret connection. It only works with a connection using Client ID / Certificate. I've posted a solution as an answer on Stack Overflow a couple months ago. But in some cases, you have no choice but to work with a Client ID / Secret (like for example writing in the User Profile Service). In that case, use the legacy App-Only principal context Why using two Azure PowerShell Modules Even if Microsoft provides a module that covers most Azure resources and the most popular is Az PowerShell , this one does not cover all features regarding AAD. For instance, let's compare one command and the options provided. New-AzADApplication New-AzureADApplication -DisplayName -DisplayName -IdentifierUris [-IdentifierUris] [-HomePage] [-Homepage] [-ReplyUrls] [-ReplyUrls] [-AvailableToOtherTenants] [-AvailableToOtherTenants] [-KeyCredentials] [-KeyCredentials] [-PasswordCredentials] [-PasswordCredentials] [-StartDate] / [-EndDate] / [-CertValue] / [-Password] / / [-AppRoles] / [-Oauth2Permissions] / [-AddIns] / [-AllowGuestsSignIn] / [-AllowPassthroughUsers] / [-AppLogoUrl] / [-ErrorUrl] / [-GroupMembershipClaims] / [-InformationalUrls] / [-IsDeviceOnlyAuthSupported] / [-IsDisabled] / [-KnownClientApplications] / [-LogoutUrl] / [-Oauth2AllowImplicitFlow] / [-Oauth2AllowUrlPathMatching] / [-Oauth2RequirePostResponse] / [-OrgRestrictions] / [-OptionalClaims] / [-ParentalControlSettings] / [-PreAuthorizedApplications] / [-PublicClient] / [-PublisherDomain] / [-RecordConsentConditions] / [-RequiredResourceAccess] / [-SamlMetadataUrl] / [-SignInAudience] / [-WwwHomepage] As you can see, the AzureAD Module provides more options just in this example. And as stated here , the AzureAD module is the one to use when working with AAD. Connect to Azure Az PowerShell 1 2 3 4 5 Connect-AzAccount # -Subscription \"SUBSCRIPTION_ID\" -TenantId \"TENANT_ID\" (if you have multiples tenants) # Wait for prompt to get credentials Get-AzContext | select Account , Tenant # Check if the context is correct Azure AD PowerShell 1 2 3 4 5 Connect-AzureAD # -TenantId \"TENANT_ID\" (if you have multiples tenants) # Wait for prompt to get credentials Get-AzureADCurrentSessionInfo | select Account , Tenant # Check if the context is correct Azure CLI 1 2 3 4 5 az login # --tenant \"TENANT_ID\" (if you have multiples tenants) # Authorize with Device Code az account show --query '[user.name,tenantId]' # Check if the context is correct Create Key Vault (and the Ressource Group) The first step is to create the Key Vault that will store the certificate. Create Key Vault through interface Create Key Vault with code Az PowerShell 1 2 3 4 5 # Create Resource Group New-AzResourceGroup -Name \"rg-common\" -Location \"westeurope\" # -Tag @{Environment=\"Production\"; Department=\"HR\"} (if tags are required by your organization) # Create KeyVault New-AzKeyVault -VaultName \"kvwecommon\" -ResourceGroupName \"rg-common\" -Location \"westeurope\" Azure CLI 1 2 3 4 5 # Create Resource Group az group create -l westeurope -n \"rg-common\" # --tags Environment=\"Production\" Department=\"HR\" (if tags are required by your organization) # Create KeyVault az keyvault create --resource-group \"rg-common\" --name \"kvwecommon\" Add certificate to Key Vault Once the Key Vault is created, we'll use its certificate creation feature to init one. Add certificate through interface Add certificate with code Az PowerShell 1 2 3 4 5 6 # Add yourself the permissions to get secret (for testing locally the solution later) and to write in the certificates store Set-AzKeyVaultAccessPolicy -VaultName \"kvwecommon\" -EmailAddress \"YOUR_EMAIL_ADDRESS\" -PermissionsToSecret get -PermissionsToCertificates import , create , get , list -PassThru # If you want to set an expiration delay beyond 12 months, specify a value with the -ValidityInMonths parameter $policy = New-AzKeyVaultCertificatePolicy -IssuerName 'Self' -KeyType RSA -RenewAtPercentageLifetime 80 -SecretContentType application / x-pkcs12 -SubjectName 'CN=MyCert' -ValidityInMonths 12 Add-AzKeyVaultCertificate -VaultName \"kvwecommon\" -Name \"MyCert\" -CertificatePolicy $policy Azure CLI 1 2 3 4 5 6 # Add yourself the permissions to get secret (for testing locally the solution later) # You can get your info with \"az ad signed-in-user show --query objectId\" az keyvault set-policy --name \"kvwecommon\" --object-id \"YOUR_OBJECT_ID\" --secret-permissions get # If you want to set an expiration delay beyond 12 months, specify a value with the --validity parameter az keyvault certificate create --vault-name \"kvwecommon\" -n \"MyCert\" -p \" $( az keyvault certificate get-default-policy ) \" Register AAD Application (and apply admin consent) Like said before, to connect to SharePoint as an application, you have two options: using the AAD Application context (accepts Client ID / Secret and certificate) using the SharePoint App-Only principal context (accepts Client ID / Secret) As we'll authenticate with a certificate, the only way is to use the AAD Application context. Register AAD App through interface Register AAD App with code To register Application permissions, you have to indicate which API you want to use and check the permissions required for you needs. If it's transparent for you when you register through the Azure Portal, let me explain how does it work under the hood. Whether you want to work with SharePoint, Microsoft Graph, Dynamics or else, each service is registered as a service principal (Enterprise Application in AAD). And each of these contains AppRoles (for Application permissions) and Oauth2Permissions (Delegated permissions). You'll notice later in the article that, for those service principals, we can refer to them as AppId and ObjectId . Depending on the command executed, the ObjectId will be required because it's unique, instead of the AppId which is the same whatever the organization is. For instance, the AppId for SharePoint is 00000003-0000-0ff1-ce00-000000000000 and for Microsoft Graph 00000003-0000-0000-c000-000000000000 . From the moment where you want to add permissions, you must register your application as a service principal too, in order to enable those permissions for your organization. Instead of the AAD Application registration user interface, you have to declare both AAD Application and its service principal (the Enterprise Application) Now that you know this, we'll see how to register the appropriate permissions and especially when admin consent is required. Register AAD App with PowerShell Azure AD PowerShell 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 # Here, we'll use the AzureAD Module # Get the service principal for \"Office 365 SharePoint Online\" $adspSPO = Get-AzureADServicePrincipal -Filter \"AppId eq '00000003-0000-0ff1-ce00-000000000000'\" # If you want to get all the available Application permissions $adspSPO . AppRoles # If you want to get all the available Delegated permissions $adspSPO . Oauth2Permissions # First, declare SharePoint permissions you want to provide to your AAD Application $reqSPO = New-Object -TypeName \"Microsoft.Open.AzureAD.Model.RequiredResourceAccess\" $reqSPO . ResourceAppId = \"00000003-0000-0ff1-ce00-000000000000\" # Here, we add Application permissions that will require admin consent $roleId = \"678536fe-1083-478a-9c59-b99265e6b0d3\" $reqSPO . ResourceAccess = New-Object System . Collections . Generic . List [Microsoft.Open.AzureAD.Model.ResourceAccess] $reqSPO . ResourceAccess . Add ( [Microsoft.Open.AzureAD.Model.ResourceAccess] :: new ( $roleId , \"Role\" )) # Sites.FullControl.All # But if you want to add Delegated permissions that will require admin consent $reqSPO . ResourceAccess . Add ( [Microsoft.Open.AzureAD.Model.ResourceAccess] :: new ( \"a468ea40-458c-4cc2-80c4-51781af71e41\" , \"Scope\" )) # TermStore.Read.All $reqSPO . ResourceAccess . Add ( [Microsoft.Open.AzureAD.Model.ResourceAccess] :: new ( \"0cea5a30-f6f8-42b5-87a0-84cc26822e02\" , \"Scope\" )) # User.Read.All # Register the AAD Application $aadApp = New-AzureADApplication -DisplayName \"MySharePointApp\" -AvailableToOtherTenants : $false -RequiredResourceAccess $reqSPO # Then, add you as an owner of the AAD Application # Get your ObjectId $yourself = Get-AzureADUser | ?{ $_ . UserPrincipalName -like \"*PART OF YOUR MAIL ADDRESS*\" } | select ObjectId # Add yourself as an owner Add-AzureADApplicationOwner -ObjectId $aadApp . ObjectId -RefObjectId $yourself . ObjectId # Register the AAD Application as a service principal $aadspapp = New-AzureADServicePrincipal -AppId $aadApp . AppId # Add the App Role Assignment mentioned before # This will grant admin consent # Execute this cmdlet as much as you have Application permission roles that requires admin consent New-AzureADServiceAppRoleAssignment -ObjectId $aadspapp . ObjectId -Id $roleId -PrincipalId $aadspapp . ObjectId -ResourceId $adspSPO . ObjectId Register AAD App with Azure CLI Azure CLI 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # If you want to get all the available Application permissions for \"Office 365 SharePoint Online\" az ad sp list --filter \"appId eq '00000003-0000-0ff1-ce00-000000000000'\" --query '[].appRoles[].{Value:value, Id:id, DisplayName:displayName}' -o table # If you want to get all the available Delegated permissions for \"Office 365 SharePoint Online\" az ad sp list --filter \"appId eq '00000003-0000-0ff1-ce00-000000000000'\" --query '[].oauth2Permissions[].{Value:value, Id:id, UserConsentDisplayName:userConsentDisplayName}' -o table # Declare SharePoint Application permissions # Sites.FullControl.All permissions = '[{\"resourceAppId\":\"00000003-0000-0ff1-ce00-000000000000\",\"resourceAccess\":[{\"id\":\"678536fe-1083-478a-9c59-b99265e6b0d3\",\"type\":\"Role\"}]}]' # Or declare SharePoint Delegated permissions (here permissions requested are TermStore.Read.All, User.Read.All) # permissions='[{\"resourceAppId\":\"00000003-0000-0ff1-ce00-000000000000\",\"resourceAccess\":[{\"id\":\"a468ea40-458c-4cc2-80c4-51781af71e41\",\"type\":\"Scope\"},{\"id\":\"0cea5a30-f6f8-42b5-87a0-84cc26822e02\",\"type\":\"Scope\"}]}]' # Register the SharePoint AAD Application with the required permissions az ad app create --display-name \"MySharePointApp\" --required-resource-accesses $permissions # Add yourself as an owner of the SharePoint AAD Application # You can get your info with \"az ad signed-in-user show --query objectId\" az ad app owner add --id \"AAD_APP_OBJECT_ID\" --owner-object-id \"YOUR_OBJECT_ID\" # Register the AAD Application as a service principal az ad sp create --id \"AAD_APP_OBJECT_ID\" # Grant admin consent # Execute this command if you have Application permission roles that requires admin consent # /!\\ You can face a 400 error when executing this command from Cloud Shell. # If so, run \"az login\" first. Known issue : https://github.com/Azure/azure-cli/issues/11749 az ad app permission admin-consent --id \"AAD_APP_OBJECT_ID\" (optional) Grant Admin Consent on Delegated permissions with PowerShell For now, if you want to work with delegated permissions on PowerShell, there's no cmdlet to grant admin consent (instead of Azure CLI, as you've see before). The only approach is to use Microsoft Graph, which provides methods to add / consent Delegated permissions. Full example here . Az PowerShell 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # Back in Az PowerShell # Assume that the Delegated permissions have been added before, through the New-AzureADApplication cmdlet # First, init Graph session token $context = Get-AzContext $ResourceGraphURI = \"https://graph.microsoft.com/\" $graphToken = [Microsoft.Azure.Commands.Common.Authentication.AzureSession] :: Instance . AuthenticationFactory . Authenticate ( $context . Account , $context . Environment , $context . Tenant . Id . ToString (), $null , [Microsoft.Azure.Commands.Common.Authentication.ShowDialog] :: Never , $null , $ResourceGraphURI ). AccessToken # Declare the scopes you want to grant access (enter the same) $body = @{ clientId = $aadspapp . ObjectId consentType = \"AllPrincipals\" principalId = $null resourceId = $adspSPO . ObjectId scope = \"AllSites.FullControl\" } $apiUrl = \"https://graph.microsoft.com/v1.0/oauth2PermissionGrants\" Invoke-RestMethod -Uri $apiUrl -Headers @{ Authorization = \"Bearer $( $graphToken ) \" } -Method POST -Body $( $body | ConvertTo-Json ) -ContentType \"application/json\" Register Web Application / API Application Now, we're going to create the resource that will query the SharePoint site. It can be a Web Application or an API. In this example, it will be a Web Application (but in the end, the code used for connecting to SharePoint will be the same). Once the Web Application created, you will have to enable Managed Identity, in order to allow the resource to access the Key Vault. This will lead in the creation of a service principal you'll be able to find in the AAD Enterprise Applications page. Register the resource through interface Enable Managed Identity through interface Register the resource with code (and enable Managed Identity) Az PowerShell 1 2 3 4 5 6 7 8 9 10 # Create App Service Plan based on Windows $appSerPlan = New-AzAppServicePlan -ResourceGroupName \"rg-common\" -Name \"asp-we-rgcommon\" -Location \"westeurope\" -Tier \"Free\" # Create Web Application # /!\\ Actually, there's no possibility to specify the Stack / Runtime with this command # /!\\ But by default, it will create an ASP.NET 4.8 one (as the App Service Plan is hosted on Windows) New-AzWebApp -ResourceGroupName \"rg-common\" -Name \"MyWebApplicationForSharePoint\" -Location \"westeurope\" -AppServicePlan $appSerPlan . Id # Enable Managed Identity (= creating a service principal) Set-AzWebApp -ResourceGroupName \"rg-common\" -Name \"MyWebApplicationForSharePoint\" -AssignIdentity $true Azure CLI 1 2 3 4 5 # Create App Service Plan (if does not exists) az appservice plan create --resource-group \"rg-common\" --name \"asp-we-rgcommon\" --location \"westeurope\" --sku F1 # Create Web Application (and its service principal) az webapp create --resource-group \"rg-common\" --name \"MyWebApplicationForSharePoint\" --plan \"asp-we-rgcommon\" --runtime \"aspnet|V4.8\" --assign-identity Upload Key Vault Certificate into AAD Application By importing the certificate (created with the Key Vault) in the AAD Application, you allow an authentication to SharePoint when requesting access to the Tenant, with a Client ID / Certificate. Upload through interface Upload with code Az PowerShell 1 2 3 4 5 6 # Get previsouly created certificate $myCert = ( Get-AzKeyVaultCertificate -VaultName \"kvwecommon\" -Name \"MyCert\" ). Certificate $certString = [Convert] :: ToBase64String ( $myCert . GetRawCertData ()) # Upload the certificate to the SharePoint AAD Application New-AzADAppCredential -ObjectId $aadApp . ObjectId -CertValue $certString -StartDate $myCert . NotBefore -EndDate $myCert . NotAfter Azure CLI 1 2 3 4 5 # Get previsouly created certificate az keyvault certificate download --vault-name \"kvwecommon\" --name \"MyCert\" -f MyCert.pem # Upload the certificate to the SharePoint AAD Application az ad sp credential reset --name \"AAD_APP_OBJECT_ID\" --cert \"@~/MyCert.pem\" Grant Web Application to get Key Vault Secret When using Microsoft.Azure.KeyVault library, we used to grant certificate (GET) access policy to certificate. But as this library is replaced by the Azure.Security .NET Libraries, we have to use the Keyvault.Secrets service because until now, there's no method provided to get a Key Vault Certificate with the certificate (GET) access policy. Furthermore, the Certificate in Key Vault is more a concept than just a type of Secret. That's why we're going to setup a secret (GET) access policy. Grant access through interface Grant access with code Az PowerShell 1 2 3 4 5 # Retrieve Web Application service principal $webappsp = Get-AzADServicePrincipal -DisplayName \"MyWebApplicationForSharePoint\" # Assign the permission Set-AzKeyVaultAccessPolicy -VaultName \"kvwecommon\" -ObjectId $webappsp . Id -PermissionsToSecrets get -PassThru Azure CLI 1 2 3 4 5 # Retrieve Web Application service principal objectId az ad sp list --display-name \"MyWebApplicationForSharePoint\" --query [] .objectId # Assign the permission az keyvault set-policy --name \"kvwecommon\" --object-id \"WEB_APPLICATION_SERVICE_PRINCIPAL_OBJECT_ID\" --secret-permissions get Init ASP.NET Web Application Project To init your project (.NET Framework 4.8 C#), you can follow this quickstart (and if you want to try with an API deployed in an Azure API, just select \"Web API\" instead of \"MVC\"). Get Nuget Packages (Azure, SharePoint) Below the Nuget packages required to test the architecture: Azure.Identy (for the authentication to the KeyVault) Azure.Security.KeyVault.Secrets (to get the certificate) Microsoft.SharePointOnline.CSOM (to work with SharePoint Site) SharePointPnPCoreOnline (to easily authenticate to SharePoint site) Setup connection to Azure To setup a connection to Azure through the Identity SDK, you can use the DefaultAzureCredential() class which will follow a specific mechanism based on the execution environment, which make this part easy to manage. To sum up, you'll be able to authenticate both in Visual Studio (as a user) and in Azure (as a managed identity / service principal) with the same method. More info here (this article also explains how to configure connection to Azure from Visual Studio). Below the snippet you can use to connect to the Key Vault, in order to get the certificate. 1 2 3 4 5 6 7 8 9 10 11 private X509Certificate2 GetCertificate () { string secretName = \"MyCert\" ; // Name of the certificate created before string keyVaultName = \"kvwecommon\" ; Uri keyVaultUri = new Uri ( $\"https://{keyVaultName}.vault.azure.net/\" ); var client = new SecretClient ( keyVaultUri , new DefaultAzureCredential ()); KeyVaultSecret secret = client . GetSecret ( secretName ); return new X509Certificate2 ( Convert . FromBase64String ( secret . Value ), string . Empty , X509KeyStorageFlags . MachineKeySet ); } Setup connection to SharePoint Once you got the certificate, you can authenticate to SharePoint site with it, in order to get a ClientContext object. 1 2 3 4 5 6 7 8 9 10 11 12 private ClientContext GetAADAppOnlyClientContext ( X509Certificate2 certificate ) { string aadApplicationId = \"SHAREPOINT_AAD_APPLICATION_APP_ID\" ; string tenantName = \"contoso\" ; string sharePointUrl = $\"https://{tenantName}.sharepoint.com/\" ; // If you want to query the User Profile, add \"-admin\" to the tenantName in the URL // string sharePointUrl = $\"https://{tenantName}-admin.sharepoint.com/\"; string tenant = $\"{tenantName}.onmicrosoft.com\" ; // This can also be the Tenant ID (GUID) instead of the Tenant Name (contoso.onmicrosoft.com) return new OfficeDevPnP . Core . AuthenticationManager (). GetAzureADAppOnlyAuthenticatedContext ( sharePointUrl , aadApplicationId , tenant , certificate ); } Get Web Info With the ClientContext object instantiated before, you can get for example info about your site. HomeController.cs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // ... // Example in the \"HomeController\" class, adding a property to the ViewBag public ActionResult Index () { X509Certificate2 certificate = GetCertificate (); ClientContext ctx = GetAADAppOnlyClientContext ( certificate ); Web currentWeb = ctx . Web ; ctx . Load ( currentWeb ); ctx . ExecuteQuery (); ViewBag . WebTitle = currentWeb . Title ; return View (); } // ... Index.cshtml 1 2 3 4 5 6 7 8 9 @{ ViewBag.Title = \"Home Page\"; } < div > Title of the SP Web : @ViewBag.WebTitle </ div > <!--...--> Deploy the solution Once you got everything, you can test your Web Application locally then by publishing it (right-click on the project and select Publish ). Then select Azure as target, Azure App Service (Windows) and select the correct Azure account, the subscription used until now, the resource group and the Web Application we created together (here rg-common and MyWebApplicationForSharePoint ). That's it You should see something like this : If you have any question or if you encounter any problem during the execution of the commands, feel free to send a Tweet or a DM \ud83d\ude09 Useful Links Create Azure AD App Registration with PowerShell-Part 1 Create Azure AD App Registration with PowerShell-Part 2 Demystifying Azure AD Service Principals Relationship between application objects and service principals","title":"Connect to SharePoint in an AAD Application permission context with a certificate stored in Azure KeyVault"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#connect-to-sharepoint-in-an-aad-application-permission-context-with-a-certificate-stored-in-azure-keyvault","text":"","title":"Connect to SharePoint in an AAD Application permission context with a certificate stored in Azure KeyVault"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#use-case","text":"You work on a Web Application (or API) which is connected to a SharePoint Tenant. You want to setup things correctly and want to execute SharePoint actions in Azure Active Directory (AAD) Application permission context.","title":"Use Case"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#goal-of-this-article","text":"This article will show how to work with a SharePoint site through an API or a Web Application, only with AAD Application permissions. It will demonstrate how to setup everything and how to connect with a certificate stored in a Key Vault, step by step, in UI, PowerShell and Azure CLI. Let's see the final result below The Web Application (or API)... Requests access to the Key Vault, in order to get the stored certificate Gets the Key Vault certificate Authenticates to Office 365 using the SharePoint AAD Application with the certificate Gets a ClientContext with the requested API permissions Uses the ClientContext object to query the SharePoint site Gets Web info (I've shrinked the 3. because there are somes requests are made to https://login.microsofonline.com , more info here )","title":"Goal of this article"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#prerequisites","text":"An Office 365 (Dev) Tenant or a Partner Demo Tenant An Azure subscription and the following Azure AD role at least Application Administrator Command Interface (one of these) PowerShell (with Az PowerShell and AzureAD PowerShell ) Azure CLI ( on your machine or through Azure Cloud Shell ) Visual Studio (2017 or later)","title":"Prerequisites"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#why-authenticating-by-certificate-and-not-by-client-id-secret","text":"In AAD Application permission context, for unknown reason, you can't work with SharePoint REST API using Client ID / Secret connection. It only works with a connection using Client ID / Certificate. I've posted a solution as an answer on Stack Overflow a couple months ago. But in some cases, you have no choice but to work with a Client ID / Secret (like for example writing in the User Profile Service). In that case, use the legacy App-Only principal context","title":"Why authenticating by certificate and not by Client ID / Secret"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#why-using-two-azure-powershell-modules","text":"Even if Microsoft provides a module that covers most Azure resources and the most popular is Az PowerShell , this one does not cover all features regarding AAD. For instance, let's compare one command and the options provided. New-AzADApplication New-AzureADApplication -DisplayName -DisplayName -IdentifierUris [-IdentifierUris] [-HomePage] [-Homepage] [-ReplyUrls] [-ReplyUrls] [-AvailableToOtherTenants] [-AvailableToOtherTenants] [-KeyCredentials] [-KeyCredentials] [-PasswordCredentials] [-PasswordCredentials] [-StartDate] / [-EndDate] / [-CertValue] / [-Password] / / [-AppRoles] / [-Oauth2Permissions] / [-AddIns] / [-AllowGuestsSignIn] / [-AllowPassthroughUsers] / [-AppLogoUrl] / [-ErrorUrl] / [-GroupMembershipClaims] / [-InformationalUrls] / [-IsDeviceOnlyAuthSupported] / [-IsDisabled] / [-KnownClientApplications] / [-LogoutUrl] / [-Oauth2AllowImplicitFlow] / [-Oauth2AllowUrlPathMatching] / [-Oauth2RequirePostResponse] / [-OrgRestrictions] / [-OptionalClaims] / [-ParentalControlSettings] / [-PreAuthorizedApplications] / [-PublicClient] / [-PublisherDomain] / [-RecordConsentConditions] / [-RequiredResourceAccess] / [-SamlMetadataUrl] / [-SignInAudience] / [-WwwHomepage] As you can see, the AzureAD Module provides more options just in this example. And as stated here , the AzureAD module is the one to use when working with AAD.","title":"Why using two Azure PowerShell Modules"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#connect-to-azure","text":"Az PowerShell 1 2 3 4 5 Connect-AzAccount # -Subscription \"SUBSCRIPTION_ID\" -TenantId \"TENANT_ID\" (if you have multiples tenants) # Wait for prompt to get credentials Get-AzContext | select Account , Tenant # Check if the context is correct Azure AD PowerShell 1 2 3 4 5 Connect-AzureAD # -TenantId \"TENANT_ID\" (if you have multiples tenants) # Wait for prompt to get credentials Get-AzureADCurrentSessionInfo | select Account , Tenant # Check if the context is correct Azure CLI 1 2 3 4 5 az login # --tenant \"TENANT_ID\" (if you have multiples tenants) # Authorize with Device Code az account show --query '[user.name,tenantId]' # Check if the context is correct","title":"Connect to Azure"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#create-key-vault-and-the-ressource-group","text":"The first step is to create the Key Vault that will store the certificate.","title":"Create Key Vault (and the Ressource Group)"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#create-key-vault-through-interface","text":"","title":"Create Key Vault through interface"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#create-key-vault-with-code","text":"Az PowerShell 1 2 3 4 5 # Create Resource Group New-AzResourceGroup -Name \"rg-common\" -Location \"westeurope\" # -Tag @{Environment=\"Production\"; Department=\"HR\"} (if tags are required by your organization) # Create KeyVault New-AzKeyVault -VaultName \"kvwecommon\" -ResourceGroupName \"rg-common\" -Location \"westeurope\" Azure CLI 1 2 3 4 5 # Create Resource Group az group create -l westeurope -n \"rg-common\" # --tags Environment=\"Production\" Department=\"HR\" (if tags are required by your organization) # Create KeyVault az keyvault create --resource-group \"rg-common\" --name \"kvwecommon\"","title":"Create Key Vault with code"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#add-certificate-to-key-vault","text":"Once the Key Vault is created, we'll use its certificate creation feature to init one.","title":"Add certificate to Key Vault"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#add-certificate-through-interface","text":"","title":"Add certificate through interface"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#add-certificate-with-code","text":"Az PowerShell 1 2 3 4 5 6 # Add yourself the permissions to get secret (for testing locally the solution later) and to write in the certificates store Set-AzKeyVaultAccessPolicy -VaultName \"kvwecommon\" -EmailAddress \"YOUR_EMAIL_ADDRESS\" -PermissionsToSecret get -PermissionsToCertificates import , create , get , list -PassThru # If you want to set an expiration delay beyond 12 months, specify a value with the -ValidityInMonths parameter $policy = New-AzKeyVaultCertificatePolicy -IssuerName 'Self' -KeyType RSA -RenewAtPercentageLifetime 80 -SecretContentType application / x-pkcs12 -SubjectName 'CN=MyCert' -ValidityInMonths 12 Add-AzKeyVaultCertificate -VaultName \"kvwecommon\" -Name \"MyCert\" -CertificatePolicy $policy Azure CLI 1 2 3 4 5 6 # Add yourself the permissions to get secret (for testing locally the solution later) # You can get your info with \"az ad signed-in-user show --query objectId\" az keyvault set-policy --name \"kvwecommon\" --object-id \"YOUR_OBJECT_ID\" --secret-permissions get # If you want to set an expiration delay beyond 12 months, specify a value with the --validity parameter az keyvault certificate create --vault-name \"kvwecommon\" -n \"MyCert\" -p \" $( az keyvault certificate get-default-policy ) \"","title":"Add certificate with code"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#register-aad-application-and-apply-admin-consent","text":"Like said before, to connect to SharePoint as an application, you have two options: using the AAD Application context (accepts Client ID / Secret and certificate) using the SharePoint App-Only principal context (accepts Client ID / Secret) As we'll authenticate with a certificate, the only way is to use the AAD Application context.","title":"Register AAD Application (and apply admin consent)"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#register-aad-app-through-interface","text":"","title":"Register AAD App through interface"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#register-aad-app-with-code","text":"To register Application permissions, you have to indicate which API you want to use and check the permissions required for you needs. If it's transparent for you when you register through the Azure Portal, let me explain how does it work under the hood. Whether you want to work with SharePoint, Microsoft Graph, Dynamics or else, each service is registered as a service principal (Enterprise Application in AAD). And each of these contains AppRoles (for Application permissions) and Oauth2Permissions (Delegated permissions). You'll notice later in the article that, for those service principals, we can refer to them as AppId and ObjectId . Depending on the command executed, the ObjectId will be required because it's unique, instead of the AppId which is the same whatever the organization is. For instance, the AppId for SharePoint is 00000003-0000-0ff1-ce00-000000000000 and for Microsoft Graph 00000003-0000-0000-c000-000000000000 . From the moment where you want to add permissions, you must register your application as a service principal too, in order to enable those permissions for your organization. Instead of the AAD Application registration user interface, you have to declare both AAD Application and its service principal (the Enterprise Application) Now that you know this, we'll see how to register the appropriate permissions and especially when admin consent is required.","title":"Register AAD App with code"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#register-aad-app-with-powershell","text":"Azure AD PowerShell 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 # Here, we'll use the AzureAD Module # Get the service principal for \"Office 365 SharePoint Online\" $adspSPO = Get-AzureADServicePrincipal -Filter \"AppId eq '00000003-0000-0ff1-ce00-000000000000'\" # If you want to get all the available Application permissions $adspSPO . AppRoles # If you want to get all the available Delegated permissions $adspSPO . Oauth2Permissions # First, declare SharePoint permissions you want to provide to your AAD Application $reqSPO = New-Object -TypeName \"Microsoft.Open.AzureAD.Model.RequiredResourceAccess\" $reqSPO . ResourceAppId = \"00000003-0000-0ff1-ce00-000000000000\" # Here, we add Application permissions that will require admin consent $roleId = \"678536fe-1083-478a-9c59-b99265e6b0d3\" $reqSPO . ResourceAccess = New-Object System . Collections . Generic . List [Microsoft.Open.AzureAD.Model.ResourceAccess] $reqSPO . ResourceAccess . Add ( [Microsoft.Open.AzureAD.Model.ResourceAccess] :: new ( $roleId , \"Role\" )) # Sites.FullControl.All # But if you want to add Delegated permissions that will require admin consent $reqSPO . ResourceAccess . Add ( [Microsoft.Open.AzureAD.Model.ResourceAccess] :: new ( \"a468ea40-458c-4cc2-80c4-51781af71e41\" , \"Scope\" )) # TermStore.Read.All $reqSPO . ResourceAccess . Add ( [Microsoft.Open.AzureAD.Model.ResourceAccess] :: new ( \"0cea5a30-f6f8-42b5-87a0-84cc26822e02\" , \"Scope\" )) # User.Read.All # Register the AAD Application $aadApp = New-AzureADApplication -DisplayName \"MySharePointApp\" -AvailableToOtherTenants : $false -RequiredResourceAccess $reqSPO # Then, add you as an owner of the AAD Application # Get your ObjectId $yourself = Get-AzureADUser | ?{ $_ . UserPrincipalName -like \"*PART OF YOUR MAIL ADDRESS*\" } | select ObjectId # Add yourself as an owner Add-AzureADApplicationOwner -ObjectId $aadApp . ObjectId -RefObjectId $yourself . ObjectId # Register the AAD Application as a service principal $aadspapp = New-AzureADServicePrincipal -AppId $aadApp . AppId # Add the App Role Assignment mentioned before # This will grant admin consent # Execute this cmdlet as much as you have Application permission roles that requires admin consent New-AzureADServiceAppRoleAssignment -ObjectId $aadspapp . ObjectId -Id $roleId -PrincipalId $aadspapp . ObjectId -ResourceId $adspSPO . ObjectId","title":"Register AAD App with PowerShell"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#register-aad-app-with-azure-cli","text":"Azure CLI 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # If you want to get all the available Application permissions for \"Office 365 SharePoint Online\" az ad sp list --filter \"appId eq '00000003-0000-0ff1-ce00-000000000000'\" --query '[].appRoles[].{Value:value, Id:id, DisplayName:displayName}' -o table # If you want to get all the available Delegated permissions for \"Office 365 SharePoint Online\" az ad sp list --filter \"appId eq '00000003-0000-0ff1-ce00-000000000000'\" --query '[].oauth2Permissions[].{Value:value, Id:id, UserConsentDisplayName:userConsentDisplayName}' -o table # Declare SharePoint Application permissions # Sites.FullControl.All permissions = '[{\"resourceAppId\":\"00000003-0000-0ff1-ce00-000000000000\",\"resourceAccess\":[{\"id\":\"678536fe-1083-478a-9c59-b99265e6b0d3\",\"type\":\"Role\"}]}]' # Or declare SharePoint Delegated permissions (here permissions requested are TermStore.Read.All, User.Read.All) # permissions='[{\"resourceAppId\":\"00000003-0000-0ff1-ce00-000000000000\",\"resourceAccess\":[{\"id\":\"a468ea40-458c-4cc2-80c4-51781af71e41\",\"type\":\"Scope\"},{\"id\":\"0cea5a30-f6f8-42b5-87a0-84cc26822e02\",\"type\":\"Scope\"}]}]' # Register the SharePoint AAD Application with the required permissions az ad app create --display-name \"MySharePointApp\" --required-resource-accesses $permissions # Add yourself as an owner of the SharePoint AAD Application # You can get your info with \"az ad signed-in-user show --query objectId\" az ad app owner add --id \"AAD_APP_OBJECT_ID\" --owner-object-id \"YOUR_OBJECT_ID\" # Register the AAD Application as a service principal az ad sp create --id \"AAD_APP_OBJECT_ID\" # Grant admin consent # Execute this command if you have Application permission roles that requires admin consent # /!\\ You can face a 400 error when executing this command from Cloud Shell. # If so, run \"az login\" first. Known issue : https://github.com/Azure/azure-cli/issues/11749 az ad app permission admin-consent --id \"AAD_APP_OBJECT_ID\"","title":"Register AAD App with Azure CLI"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#optional-grant-admin-consent-on-delegated-permissions-with-powershell","text":"For now, if you want to work with delegated permissions on PowerShell, there's no cmdlet to grant admin consent (instead of Azure CLI, as you've see before). The only approach is to use Microsoft Graph, which provides methods to add / consent Delegated permissions. Full example here . Az PowerShell 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # Back in Az PowerShell # Assume that the Delegated permissions have been added before, through the New-AzureADApplication cmdlet # First, init Graph session token $context = Get-AzContext $ResourceGraphURI = \"https://graph.microsoft.com/\" $graphToken = [Microsoft.Azure.Commands.Common.Authentication.AzureSession] :: Instance . AuthenticationFactory . Authenticate ( $context . Account , $context . Environment , $context . Tenant . Id . ToString (), $null , [Microsoft.Azure.Commands.Common.Authentication.ShowDialog] :: Never , $null , $ResourceGraphURI ). AccessToken # Declare the scopes you want to grant access (enter the same) $body = @{ clientId = $aadspapp . ObjectId consentType = \"AllPrincipals\" principalId = $null resourceId = $adspSPO . ObjectId scope = \"AllSites.FullControl\" } $apiUrl = \"https://graph.microsoft.com/v1.0/oauth2PermissionGrants\" Invoke-RestMethod -Uri $apiUrl -Headers @{ Authorization = \"Bearer $( $graphToken ) \" } -Method POST -Body $( $body | ConvertTo-Json ) -ContentType \"application/json\"","title":"(optional) Grant Admin Consent on Delegated permissions with PowerShell"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#register-web-application-api-application","text":"Now, we're going to create the resource that will query the SharePoint site. It can be a Web Application or an API. In this example, it will be a Web Application (but in the end, the code used for connecting to SharePoint will be the same). Once the Web Application created, you will have to enable Managed Identity, in order to allow the resource to access the Key Vault. This will lead in the creation of a service principal you'll be able to find in the AAD Enterprise Applications page.","title":"Register Web Application / API Application"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#register-the-resource-through-interface","text":"","title":"Register the resource through interface"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#enable-managed-identity-through-interface","text":"","title":"Enable Managed Identity through interface"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#register-the-resource-with-code-and-enable-managed-identity","text":"Az PowerShell 1 2 3 4 5 6 7 8 9 10 # Create App Service Plan based on Windows $appSerPlan = New-AzAppServicePlan -ResourceGroupName \"rg-common\" -Name \"asp-we-rgcommon\" -Location \"westeurope\" -Tier \"Free\" # Create Web Application # /!\\ Actually, there's no possibility to specify the Stack / Runtime with this command # /!\\ But by default, it will create an ASP.NET 4.8 one (as the App Service Plan is hosted on Windows) New-AzWebApp -ResourceGroupName \"rg-common\" -Name \"MyWebApplicationForSharePoint\" -Location \"westeurope\" -AppServicePlan $appSerPlan . Id # Enable Managed Identity (= creating a service principal) Set-AzWebApp -ResourceGroupName \"rg-common\" -Name \"MyWebApplicationForSharePoint\" -AssignIdentity $true Azure CLI 1 2 3 4 5 # Create App Service Plan (if does not exists) az appservice plan create --resource-group \"rg-common\" --name \"asp-we-rgcommon\" --location \"westeurope\" --sku F1 # Create Web Application (and its service principal) az webapp create --resource-group \"rg-common\" --name \"MyWebApplicationForSharePoint\" --plan \"asp-we-rgcommon\" --runtime \"aspnet|V4.8\" --assign-identity","title":"Register the resource with code (and enable Managed Identity)"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#upload-key-vault-certificate-into-aad-application","text":"By importing the certificate (created with the Key Vault) in the AAD Application, you allow an authentication to SharePoint when requesting access to the Tenant, with a Client ID / Certificate.","title":"Upload Key Vault Certificate into AAD Application"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#upload-through-interface","text":"","title":"Upload through interface"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#upload-with-code","text":"Az PowerShell 1 2 3 4 5 6 # Get previsouly created certificate $myCert = ( Get-AzKeyVaultCertificate -VaultName \"kvwecommon\" -Name \"MyCert\" ). Certificate $certString = [Convert] :: ToBase64String ( $myCert . GetRawCertData ()) # Upload the certificate to the SharePoint AAD Application New-AzADAppCredential -ObjectId $aadApp . ObjectId -CertValue $certString -StartDate $myCert . NotBefore -EndDate $myCert . NotAfter Azure CLI 1 2 3 4 5 # Get previsouly created certificate az keyvault certificate download --vault-name \"kvwecommon\" --name \"MyCert\" -f MyCert.pem # Upload the certificate to the SharePoint AAD Application az ad sp credential reset --name \"AAD_APP_OBJECT_ID\" --cert \"@~/MyCert.pem\"","title":"Upload with code"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#grant-web-application-to-get-key-vault-secret","text":"When using Microsoft.Azure.KeyVault library, we used to grant certificate (GET) access policy to certificate. But as this library is replaced by the Azure.Security .NET Libraries, we have to use the Keyvault.Secrets service because until now, there's no method provided to get a Key Vault Certificate with the certificate (GET) access policy. Furthermore, the Certificate in Key Vault is more a concept than just a type of Secret. That's why we're going to setup a secret (GET) access policy.","title":"Grant Web Application to get Key Vault Secret"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#grant-access-through-interface","text":"","title":"Grant access through interface"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#grant-access-with-code","text":"Az PowerShell 1 2 3 4 5 # Retrieve Web Application service principal $webappsp = Get-AzADServicePrincipal -DisplayName \"MyWebApplicationForSharePoint\" # Assign the permission Set-AzKeyVaultAccessPolicy -VaultName \"kvwecommon\" -ObjectId $webappsp . Id -PermissionsToSecrets get -PassThru Azure CLI 1 2 3 4 5 # Retrieve Web Application service principal objectId az ad sp list --display-name \"MyWebApplicationForSharePoint\" --query [] .objectId # Assign the permission az keyvault set-policy --name \"kvwecommon\" --object-id \"WEB_APPLICATION_SERVICE_PRINCIPAL_OBJECT_ID\" --secret-permissions get","title":"Grant access with code"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#init-aspnet-web-application-project","text":"To init your project (.NET Framework 4.8 C#), you can follow this quickstart (and if you want to try with an API deployed in an Azure API, just select \"Web API\" instead of \"MVC\").","title":"Init ASP.NET Web Application Project"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#get-nuget-packages-azure-sharepoint","text":"Below the Nuget packages required to test the architecture: Azure.Identy (for the authentication to the KeyVault) Azure.Security.KeyVault.Secrets (to get the certificate) Microsoft.SharePointOnline.CSOM (to work with SharePoint Site) SharePointPnPCoreOnline (to easily authenticate to SharePoint site)","title":"Get Nuget Packages (Azure, SharePoint)"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#setup-connection-to-azure","text":"To setup a connection to Azure through the Identity SDK, you can use the DefaultAzureCredential() class which will follow a specific mechanism based on the execution environment, which make this part easy to manage. To sum up, you'll be able to authenticate both in Visual Studio (as a user) and in Azure (as a managed identity / service principal) with the same method. More info here (this article also explains how to configure connection to Azure from Visual Studio). Below the snippet you can use to connect to the Key Vault, in order to get the certificate. 1 2 3 4 5 6 7 8 9 10 11 private X509Certificate2 GetCertificate () { string secretName = \"MyCert\" ; // Name of the certificate created before string keyVaultName = \"kvwecommon\" ; Uri keyVaultUri = new Uri ( $\"https://{keyVaultName}.vault.azure.net/\" ); var client = new SecretClient ( keyVaultUri , new DefaultAzureCredential ()); KeyVaultSecret secret = client . GetSecret ( secretName ); return new X509Certificate2 ( Convert . FromBase64String ( secret . Value ), string . Empty , X509KeyStorageFlags . MachineKeySet ); }","title":"Setup connection to Azure"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#setup-connection-to-sharepoint","text":"Once you got the certificate, you can authenticate to SharePoint site with it, in order to get a ClientContext object. 1 2 3 4 5 6 7 8 9 10 11 12 private ClientContext GetAADAppOnlyClientContext ( X509Certificate2 certificate ) { string aadApplicationId = \"SHAREPOINT_AAD_APPLICATION_APP_ID\" ; string tenantName = \"contoso\" ; string sharePointUrl = $\"https://{tenantName}.sharepoint.com/\" ; // If you want to query the User Profile, add \"-admin\" to the tenantName in the URL // string sharePointUrl = $\"https://{tenantName}-admin.sharepoint.com/\"; string tenant = $\"{tenantName}.onmicrosoft.com\" ; // This can also be the Tenant ID (GUID) instead of the Tenant Name (contoso.onmicrosoft.com) return new OfficeDevPnP . Core . AuthenticationManager (). GetAzureADAppOnlyAuthenticatedContext ( sharePointUrl , aadApplicationId , tenant , certificate ); }","title":"Setup connection to SharePoint"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#get-web-info","text":"With the ClientContext object instantiated before, you can get for example info about your site. HomeController.cs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // ... // Example in the \"HomeController\" class, adding a property to the ViewBag public ActionResult Index () { X509Certificate2 certificate = GetCertificate (); ClientContext ctx = GetAADAppOnlyClientContext ( certificate ); Web currentWeb = ctx . Web ; ctx . Load ( currentWeb ); ctx . ExecuteQuery (); ViewBag . WebTitle = currentWeb . Title ; return View (); } // ... Index.cshtml 1 2 3 4 5 6 7 8 9 @{ ViewBag.Title = \"Home Page\"; } < div > Title of the SP Web : @ViewBag.WebTitle </ div > <!--...-->","title":"Get Web Info"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#deploy-the-solution","text":"Once you got everything, you can test your Web Application locally then by publishing it (right-click on the project and select Publish ). Then select Azure as target, Azure App Service (Windows) and select the correct Azure account, the subscription used until now, the resource group and the Web Application we created together (here rg-common and MyWebApplicationForSharePoint ).","title":"Deploy the solution"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#thats-it","text":"You should see something like this : If you have any question or if you encounter any problem during the execution of the commands, feel free to send a Tweet or a DM \ud83d\ude09","title":"That's it"},{"location":"articles/20201119-connect-to-sharepoint-apppermission-certificate-keyvault/#useful-links","text":"Create Azure AD App Registration with PowerShell-Part 1 Create Azure AD App Registration with PowerShell-Part 2 Demystifying Azure AD Service Principals Relationship between application objects and service principals","title":"Useful Links"},{"location":"articles/20210125-azure-function-authentication-with-pnpframework/","text":"Authenticate to SharePoint Online through an Azure Function using PnP Framework As you know (or maybe not?), the PnP Framework (v1.0.0) is now GA! \ud83c\udf89 For those who are new here, it's a framework developed by the community (Microsoft employees, MVPs and other passionate developers), successor of the PnP Sites Core library and .NET Standard 2.0 compatible (.NET Framework 5 and .NET Core). As the PnP Sites Core is no longer maintained, the PnP Framework is the new library to use for your Microsoft 365 Developments! This library will extend the SharePoint CSOM library by adding useful features such as simplified authentication flows (including token management), extensions methods to objects, utilities and more! One important thing to know is that this framework is a transitional one, while the real successor will be the PnP Core SDK (on which PnP Framework and the new PnP PowerShell depends) but is still in beta. More info here and here . Among the major features of the PnP Framework, one is the authentication workflow used inside, which is now based on MSAL SDK for .NET! This is a great improvment, which involves some small changes regarding the code that will manage the authentication. Let's see with a short example! Prerequisites An Office 365 (Dev) Tenant or a Partner Demo Tenant Visual Studio (2017 or later) including the Azure Development workload ( Azure Function Core (CLI) Tools ) ( optional ) An Azure subscription and the following Azure AD role at least Application Administrator About Azure Functions v1 For those who are familiar with Azure Functions v1 and SharePoint CSOM with latest version of PnP Sites Core library, you're probably aware of a compatibility issue regarding the Newtonsoft.Json library, which uses the 9.0.1 version in the Microsoft.NET.Sdk.Functions (v1.0.38) library, and a newer version in the PnP Sites Core library (issue referenced here ). Great news: the PnP Framework works perfectly with Azure Functions v3 (using Microsoft.NET.Sdk.Functions v3.0.11), let's check it out! Init Azure Function v3 You can follow this quick start to init a project. (Follow the steps until the Testing functions part, the Azure part will follow later as an option) Get Nuget Packages Below the Nuget packages required to test the architecture: Microsoft.SharePointOnline.CSOM (to work with SharePoint Site) PnP.Framework (to easily authenticate to SharePoint site) ( optional ) Azure.Identy (for the authentication to the KeyVault) ( optional ) Azure.Security.KeyVault.Secrets (to get the certificate) Setup connection to SharePoint Below the code sample to setup a connection to SharePoint using Client Credential Flow HttpExample.cs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 [FunctionName(\"HttpExample\")] public static async Task < IActionResult > Run ( [HttpTrigger(AuthorizationLevel.Function, \"get\", \"post\", Route = null)] HttpRequest req , ILogger log ) { Web currentWeb ; string userLogin = \"AdeleV@contoso.onmicrosoft.com\" ; string userPassword = \"Pass@w0rd!\" ; string sharePointUrl = \"https://contoso.sharepoint.com\" ; var securePassword = new SecureString (); foreach ( char c in userPassword ) { securePassword . AppendChar ( c ); } AuthenticationManager auth = new AuthenticationManager ( userLogin , securePassword ); using ( ClientContext ctx = await auth . GetContextAsync ( sharePointUrl )) { currentWeb = ctx . Web ; ctx . Load ( currentWeb ); await ctx . ExecuteQueryRetryAsync (); } log . LogInformation ( $\"Web's title : {currentWeb.Title}\" ); return new OkObjectResult ( $\"Web's title : {currentWeb.Title}\" ); } Warning This authentication method is available through the PnP Framework, but not by design with CSOM for .NET Standard. More info here Try it locally Once you've got everything ready, run your function locally! Go to your browser and type http://localhost:5800/api/HttpExample You should see something like this: From the Azure Functions Core Tools From the browser Setup connection with a certificate (optional) Now let's say you want to execute your Function App in an Azure AD (AAD) Application context. The idea is to use a certificate stored in an Azure Key Vault. For the AAD Application registration, the creation of the Key Vault, the setup of managed identity and the configuration of SharePoint API Permissions, I'll redirect you to my previous article here . Below the complete script to authenticate through AAD 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 [FunctionName(\"HttpExample\")] public static async Task < IActionResult > Run ( [HttpTrigger(AuthorizationLevel.Function, \"get\", \"post\", Route = null)] HttpRequest req , ILogger log ) { Web currentWeb ; string aadApplicationId = \"SHAREPOINT_AAD_APPLICATION_APP_ID\" ; string tenantName = \"contoso\" ; string sharePointUrl = $\"https://{tenantName}.sharepoint.com/\" ; AuthenticationManager auth = new AuthenticationManager ( aadApplicationId , GetCertificate (), $\"{tenantName}.onmicrosoft.com\" ); using ( ClientContext ctx = await auth . GetContextAsync ( sharePointUrl )) { currentWeb = ctx . Web ; ctx . Load ( currentWeb ); await ctx . ExecuteQueryRetryAsync (); } log . LogInformation ( $\"Web's title : {currentWeb.Title}\" ); return new OkObjectResult ( $\"Web's title : {currentWeb.Title}\" ); } private X509Certificate2 GetCertificate () { string secretName = \"MyCert\" ; // Name of the certificate Uri keyVaultUri = new Uri ( $\"https://kvwecommon.vault.azure.net/\" ); var client = new SecretClient ( keyVaultUri , new DefaultAzureCredential ()); KeyVaultSecret secret = client . GetSecret ( secretName ); return new X509Certificate2 ( Convert . FromBase64String ( secret . Value ), string . Empty , X509KeyStorageFlags . MachineKeySet ); } That's it As you can see, the main object to work with during authentication is the AutenticationManager object, which will lead you to manage authentication flows, such as client credential, device code or certificate. It's this object that will now handle login info (except for legacy SharePoint AppOnly authentication which uses Azure ACS). Happy coding!","title":"Authenticate to SharePoint Online through an Azure Function using PnP Framework"},{"location":"articles/20210125-azure-function-authentication-with-pnpframework/#authenticate-to-sharepoint-online-through-an-azure-function-using-pnp-framework","text":"As you know (or maybe not?), the PnP Framework (v1.0.0) is now GA! \ud83c\udf89 For those who are new here, it's a framework developed by the community (Microsoft employees, MVPs and other passionate developers), successor of the PnP Sites Core library and .NET Standard 2.0 compatible (.NET Framework 5 and .NET Core). As the PnP Sites Core is no longer maintained, the PnP Framework is the new library to use for your Microsoft 365 Developments! This library will extend the SharePoint CSOM library by adding useful features such as simplified authentication flows (including token management), extensions methods to objects, utilities and more! One important thing to know is that this framework is a transitional one, while the real successor will be the PnP Core SDK (on which PnP Framework and the new PnP PowerShell depends) but is still in beta. More info here and here . Among the major features of the PnP Framework, one is the authentication workflow used inside, which is now based on MSAL SDK for .NET! This is a great improvment, which involves some small changes regarding the code that will manage the authentication. Let's see with a short example!","title":"Authenticate to SharePoint Online through an Azure Function using PnP Framework"},{"location":"articles/20210125-azure-function-authentication-with-pnpframework/#prerequisites","text":"An Office 365 (Dev) Tenant or a Partner Demo Tenant Visual Studio (2017 or later) including the Azure Development workload ( Azure Function Core (CLI) Tools ) ( optional ) An Azure subscription and the following Azure AD role at least Application Administrator","title":"Prerequisites"},{"location":"articles/20210125-azure-function-authentication-with-pnpframework/#about-azure-functions-v1","text":"For those who are familiar with Azure Functions v1 and SharePoint CSOM with latest version of PnP Sites Core library, you're probably aware of a compatibility issue regarding the Newtonsoft.Json library, which uses the 9.0.1 version in the Microsoft.NET.Sdk.Functions (v1.0.38) library, and a newer version in the PnP Sites Core library (issue referenced here ). Great news: the PnP Framework works perfectly with Azure Functions v3 (using Microsoft.NET.Sdk.Functions v3.0.11), let's check it out!","title":"About Azure Functions v1"},{"location":"articles/20210125-azure-function-authentication-with-pnpframework/#init-azure-function-v3","text":"You can follow this quick start to init a project. (Follow the steps until the Testing functions part, the Azure part will follow later as an option)","title":"Init Azure Function v3"},{"location":"articles/20210125-azure-function-authentication-with-pnpframework/#get-nuget-packages","text":"Below the Nuget packages required to test the architecture: Microsoft.SharePointOnline.CSOM (to work with SharePoint Site) PnP.Framework (to easily authenticate to SharePoint site) ( optional ) Azure.Identy (for the authentication to the KeyVault) ( optional ) Azure.Security.KeyVault.Secrets (to get the certificate)","title":"Get Nuget Packages"},{"location":"articles/20210125-azure-function-authentication-with-pnpframework/#setup-connection-to-sharepoint","text":"Below the code sample to setup a connection to SharePoint using Client Credential Flow HttpExample.cs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 [FunctionName(\"HttpExample\")] public static async Task < IActionResult > Run ( [HttpTrigger(AuthorizationLevel.Function, \"get\", \"post\", Route = null)] HttpRequest req , ILogger log ) { Web currentWeb ; string userLogin = \"AdeleV@contoso.onmicrosoft.com\" ; string userPassword = \"Pass@w0rd!\" ; string sharePointUrl = \"https://contoso.sharepoint.com\" ; var securePassword = new SecureString (); foreach ( char c in userPassword ) { securePassword . AppendChar ( c ); } AuthenticationManager auth = new AuthenticationManager ( userLogin , securePassword ); using ( ClientContext ctx = await auth . GetContextAsync ( sharePointUrl )) { currentWeb = ctx . Web ; ctx . Load ( currentWeb ); await ctx . ExecuteQueryRetryAsync (); } log . LogInformation ( $\"Web's title : {currentWeb.Title}\" ); return new OkObjectResult ( $\"Web's title : {currentWeb.Title}\" ); } Warning This authentication method is available through the PnP Framework, but not by design with CSOM for .NET Standard. More info here","title":"Setup connection to SharePoint"},{"location":"articles/20210125-azure-function-authentication-with-pnpframework/#try-it-locally","text":"Once you've got everything ready, run your function locally! Go to your browser and type http://localhost:5800/api/HttpExample You should see something like this: From the Azure Functions Core Tools From the browser","title":"Try it locally"},{"location":"articles/20210125-azure-function-authentication-with-pnpframework/#setup-connection-with-a-certificate-optional","text":"Now let's say you want to execute your Function App in an Azure AD (AAD) Application context. The idea is to use a certificate stored in an Azure Key Vault. For the AAD Application registration, the creation of the Key Vault, the setup of managed identity and the configuration of SharePoint API Permissions, I'll redirect you to my previous article here . Below the complete script to authenticate through AAD 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 [FunctionName(\"HttpExample\")] public static async Task < IActionResult > Run ( [HttpTrigger(AuthorizationLevel.Function, \"get\", \"post\", Route = null)] HttpRequest req , ILogger log ) { Web currentWeb ; string aadApplicationId = \"SHAREPOINT_AAD_APPLICATION_APP_ID\" ; string tenantName = \"contoso\" ; string sharePointUrl = $\"https://{tenantName}.sharepoint.com/\" ; AuthenticationManager auth = new AuthenticationManager ( aadApplicationId , GetCertificate (), $\"{tenantName}.onmicrosoft.com\" ); using ( ClientContext ctx = await auth . GetContextAsync ( sharePointUrl )) { currentWeb = ctx . Web ; ctx . Load ( currentWeb ); await ctx . ExecuteQueryRetryAsync (); } log . LogInformation ( $\"Web's title : {currentWeb.Title}\" ); return new OkObjectResult ( $\"Web's title : {currentWeb.Title}\" ); } private X509Certificate2 GetCertificate () { string secretName = \"MyCert\" ; // Name of the certificate Uri keyVaultUri = new Uri ( $\"https://kvwecommon.vault.azure.net/\" ); var client = new SecretClient ( keyVaultUri , new DefaultAzureCredential ()); KeyVaultSecret secret = client . GetSecret ( secretName ); return new X509Certificate2 ( Convert . FromBase64String ( secret . Value ), string . Empty , X509KeyStorageFlags . MachineKeySet ); }","title":"Setup connection with a certificate (optional)"},{"location":"articles/20210125-azure-function-authentication-with-pnpframework/#thats-it","text":"As you can see, the main object to work with during authentication is the AutenticationManager object, which will lead you to manage authentication flows, such as client credential, device code or certificate. It's this object that will now handle login info (except for legacy SharePoint AppOnly authentication which uses Azure ACS). Happy coding!","title":"That's it"},{"location":"tips/20200213-csom-test-file-folder-existence/","text":"[CSOM] Test in your C# code if a SharePoint File or Folder exists A Simple Use Case When you want to know if a file or folder already exists on a SharePoint Site (in a migration use case for example, before perform a copy / move), you can have some bad surprises. Let's try with a simple folder case example. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 string userName = \"user@tenant.onmicrosoft.com\"; SecureString securePassword = new SecureString(); foreach (var cc in \"yourPlainTextPassword\") { securePassword.AppendChar(cc); } using (ClientContext spContext = new ClientContext(\"SharePointSiteUrl\")) { spContext.Credentials = new SharePointOnlineCredentials(userName, securePassword); spContext.ExecuteQuery(); Web currentWeb = spContext.Web; List docLibrary = currentWeb.Lists.GetByTitle(\"Documents\"); spContext.Load(docLibrary); spContext.Load(docLibrary.RootFolder); spContext.ExecuteQuery(); string folderPath = docLibrary.RootFolder.ServerRelativeUrl + \"/MyFolderThatDoesNotExists\"; Folder folderToGet = currentWeb.GetFolderByServerRelativeUrl(folderPath); spContext.Load(folderToGet, f => f.Exists); try { spContext.ExecuteQuery(); if (folderToGet.Exists) { // Do something } else { // Do something else } } catch (Exception ex) { Console.WriteLine(ex.Message); } } The twisted thing here's that the if (folderToGet.Exists) line won't be reached. Because if you use the \"GetFolderByServerRelativeUrl\" and the folder actually doesn't exists (or any parent folder in the hierarchy), it'll throw an exception. But if it exists, then you'll be able to test the value of folderToGet.Exists property (which obviously will return true ). Clever. So you want to test if a folder exists but without to constantly catch the error... Good news : the SharePointPnPCoreOnline Package implements this ! Let's try it : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // Credentials declaration like above ... using ( ClientContext spContext = new ClientContext ( \"SharePointSiteUrl\" )) { // Connection like above ... string folderPath = docLibrary . RootFolder . ServerRelativeUrl + \"/MyFileThatDoesNotExists\" ; bool exists = currentWeb . DoesFolderExists ( folderPath ); if ( exists ) { // Do something } else { // Do something else } } And that's it ! The DoesFolderExists Method provides this test. And it also works with folder hierarchy containing special characters \ud83d\ude09. For testing the existance of a file, there's not any equivalent. So if you try to get a file that doesn't exists : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // Credentials declaration like above ... using ( ClientContext spContext = new ClientContext ( \"SharePointSiteUrl\" )) { // Connection like above ... string filePath = docLibrary . RootFolder . ServerRelativeUrl + \"/MyFileThatDoesNotExists\" ; File fileToGet = currentWeb . GetFileByServerRelativeUrl ( filePath ); spContext . Load ( fileToGet , f => f . Exists ); try { spContext . ExecuteQuery (); } catch ( Exception ex ) { Console . WriteLine ( ex . Message ); } } It'll also throw an exception. So the thing here is to use the GetFileByServerRelativePath method which returns a File object, whether it exists or not. And there : the \"Exists\" property can be used. The great thing about this method is that it also works if you file (or your folder hierarchy) contains special characters: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // Credentials declaration like above ... using ( ClientContext spContext = new ClientContext ( \"SharePointSiteUrl\" )) { // Connection like above ... string filePath = docLibrary . RootFolder . ServerRelativeUrl + \"/# My Tricky File \u00fch\u00fch\u00fc.docx\" ; File fileToGet = currentWeb . GetFileByServerRelativePath ( ResourcePath . FromDecodedUrl ( filePath )); spContext . Load ( fileToGet , f => f . Exists ); try { spContext . ExecuteQuery (); if ( fileToGet . Exists ) { // Do something } else { // Do something else } } catch ( Exception ex ) { Console . WriteLine ( ex . Message ); } } Bonus : Using the Windows Credential Manager For Windows users, if you don't want to always write your credentials and if you already know the Add / Get -PnPStoredCredential cmdlets, you might be interested to use the CredentialManager class provided by the Adys Tech company. You can fin the Nugget package here . Then, when referencing it, you just have to use it like this: 1 2 3 var cred = CredentialManager . GetCredentials ( \"PnPPS:CredentialsName\" ); string user = cred . UserName ; SecureString pwd = cred . SecurePassword ; Useful Links FileFolderExtensions.DoesFolderExists from SharePoint Online PnP Core Supporting % and # in files and folders with the ResourcePath API","title":"[CSOM] Test in your C# code if a SharePoint File or Folder exists"},{"location":"tips/20200213-csom-test-file-folder-existence/#csom-test-in-your-c-code-if-a-sharepoint-file-or-folder-exists","text":"","title":"[CSOM] Test in your C# code if a SharePoint File or Folder exists"},{"location":"tips/20200213-csom-test-file-folder-existence/#a-simple-use-case","text":"When you want to know if a file or folder already exists on a SharePoint Site (in a migration use case for example, before perform a copy / move), you can have some bad surprises. Let's try with a simple folder case example. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 string userName = \"user@tenant.onmicrosoft.com\"; SecureString securePassword = new SecureString(); foreach (var cc in \"yourPlainTextPassword\") { securePassword.AppendChar(cc); } using (ClientContext spContext = new ClientContext(\"SharePointSiteUrl\")) { spContext.Credentials = new SharePointOnlineCredentials(userName, securePassword); spContext.ExecuteQuery(); Web currentWeb = spContext.Web; List docLibrary = currentWeb.Lists.GetByTitle(\"Documents\"); spContext.Load(docLibrary); spContext.Load(docLibrary.RootFolder); spContext.ExecuteQuery(); string folderPath = docLibrary.RootFolder.ServerRelativeUrl + \"/MyFolderThatDoesNotExists\"; Folder folderToGet = currentWeb.GetFolderByServerRelativeUrl(folderPath); spContext.Load(folderToGet, f => f.Exists); try { spContext.ExecuteQuery(); if (folderToGet.Exists) { // Do something } else { // Do something else } } catch (Exception ex) { Console.WriteLine(ex.Message); } } The twisted thing here's that the if (folderToGet.Exists) line won't be reached. Because if you use the \"GetFolderByServerRelativeUrl\" and the folder actually doesn't exists (or any parent folder in the hierarchy), it'll throw an exception. But if it exists, then you'll be able to test the value of folderToGet.Exists property (which obviously will return true ). Clever. So you want to test if a folder exists but without to constantly catch the error... Good news : the SharePointPnPCoreOnline Package implements this ! Let's try it : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // Credentials declaration like above ... using ( ClientContext spContext = new ClientContext ( \"SharePointSiteUrl\" )) { // Connection like above ... string folderPath = docLibrary . RootFolder . ServerRelativeUrl + \"/MyFileThatDoesNotExists\" ; bool exists = currentWeb . DoesFolderExists ( folderPath ); if ( exists ) { // Do something } else { // Do something else } } And that's it ! The DoesFolderExists Method provides this test. And it also works with folder hierarchy containing special characters \ud83d\ude09. For testing the existance of a file, there's not any equivalent. So if you try to get a file that doesn't exists : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // Credentials declaration like above ... using ( ClientContext spContext = new ClientContext ( \"SharePointSiteUrl\" )) { // Connection like above ... string filePath = docLibrary . RootFolder . ServerRelativeUrl + \"/MyFileThatDoesNotExists\" ; File fileToGet = currentWeb . GetFileByServerRelativeUrl ( filePath ); spContext . Load ( fileToGet , f => f . Exists ); try { spContext . ExecuteQuery (); } catch ( Exception ex ) { Console . WriteLine ( ex . Message ); } } It'll also throw an exception. So the thing here is to use the GetFileByServerRelativePath method which returns a File object, whether it exists or not. And there : the \"Exists\" property can be used. The great thing about this method is that it also works if you file (or your folder hierarchy) contains special characters: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // Credentials declaration like above ... using ( ClientContext spContext = new ClientContext ( \"SharePointSiteUrl\" )) { // Connection like above ... string filePath = docLibrary . RootFolder . ServerRelativeUrl + \"/# My Tricky File \u00fch\u00fch\u00fc.docx\" ; File fileToGet = currentWeb . GetFileByServerRelativePath ( ResourcePath . FromDecodedUrl ( filePath )); spContext . Load ( fileToGet , f => f . Exists ); try { spContext . ExecuteQuery (); if ( fileToGet . Exists ) { // Do something } else { // Do something else } } catch ( Exception ex ) { Console . WriteLine ( ex . Message ); } }","title":"A Simple Use Case"},{"location":"tips/20200213-csom-test-file-folder-existence/#bonus-using-the-windows-credential-manager","text":"For Windows users, if you don't want to always write your credentials and if you already know the Add / Get -PnPStoredCredential cmdlets, you might be interested to use the CredentialManager class provided by the Adys Tech company. You can fin the Nugget package here . Then, when referencing it, you just have to use it like this: 1 2 3 var cred = CredentialManager . GetCredentials ( \"PnPPS:CredentialsName\" ); string user = cred . UserName ; SecureString pwd = cred . SecurePassword ;","title":"Bonus : Using the Windows Credential Manager"},{"location":"tips/20200213-csom-test-file-folder-existence/#useful-links","text":"FileFolderExtensions.DoesFolderExists from SharePoint Online PnP Core Supporting % and # in files and folders with the ResourcePath API","title":"Useful Links"},{"location":"tips/20200505-spfx-progressindicator-to-countdown-timer/","text":"[SPFx] Transform the Fluent UI ProgressIndicator component into a countdown timer Info As you know, the well-know Office UI Fabric front-end infrastructure has been renamed as Fluent UI ! (more info here ) Recently, I had to develop a certification exam with SPFx. One of the features was to provide a countdown within the questions. As I'm familiar with React and the Fluent UI components, I was wondering if it was possible to reuse the ProgressIndicator component and set it up in reverse mode. So here we go ! Existing sample First, let's have a look at the sample provided here . 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 import * as React from 'react' ; import { ProgressIndicator } from 'office-ui-fabric-react/lib/ProgressIndicator' ; import { Async } from 'office-ui-fabric-react/lib/Utilities' ; export interface IProgressIndicatorBasicExampleState { percentComplete : number ; } const INTERVAL_DELAY = 100 ; const INTERVAL_INCREMENT = 0.01 ; const RESTART_WAIT_TIME = 2000 ; export class ProgressIndicatorBasicExample extends React . Component < {}, IProgressIndicatorBasicExampleState > { private _interval : number ; private _async : Async ; constructor ( props : {}) { super ( props ); this . _async = new Async ( this ); this . state = { percentComplete : 0 , }; this . _startProgressDemo = this . _startProgressDemo . bind ( this ); } public componentDidMount () : void { this . _startProgressDemo (); } public componentWillUnmount () : void { this . _async . dispose (); } public render () : JSX . Element { const { percentComplete } = this . state ; return ( < ProgressIndicator label = \"Example title\" description = \"Example description\" percentComplete = { percentComplete } /> ); } private _startProgressDemo () : void { // reset the demo this . setState ({ percentComplete : 0 , }); // update progress this . _interval = this . _async . setInterval (() => { let percentComplete = this . state . percentComplete + INTERVAL_INCREMENT ; // once complete, set the demo to start again if ( percentComplete >= 1.0 ) { percentComplete = 1.0 ; this . _async . clearInterval ( this . _interval ); this . _async . setTimeout ( this . _startProgressDemo , RESTART_WAIT_TIME ); } this . setState ({ percentComplete : percentComplete , }); }, INTERVAL_DELAY ); } } This code gives this behavior: Countdown mode Now, let's reverse the process. Let's say that you want your countdown set to 30 seconds. You can replace the const variable INTERVAL_INCREMENT (which won't be used anymore) by COUNTDOWN_DURATION . For this demo, the duration will be in milliseconds. 1 2 3 4 5 6 7 8 9 10 11 12 import * as React from 'react' ; import { ProgressIndicator } from 'office-ui-fabric-react/lib/ProgressIndicator' ; import { Async } from 'office-ui-fabric-react/lib/Utilities' ; export interface IProgressIndicatorBasicExampleState { percentComplete : number ; } const INTERVAL_DELAY = 100 ; const COUNTDOWN_DURATION = 30000 ; const RESTART_WAIT_TIME = 2000 ; //... Then, you can set the percentComplete state to 1 in the constructor (remember that this variable is used as a parameter of the component, which goes from 0 to 1). So that the initial state of the Indicator is 1. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 //... export class ProgressIndicatorBasicExample extends React . Component < {}, IProgressIndicatorBasicExampleState > { private _interval : number ; private _async : Async ; constructor ( props : {}) { super ( props ); this . _async = new Async ( this ); this . state = { percentComplete : 1 , // --> initial state }; this . _startProgressDemo = this . _startProgressDemo . bind ( this ); } //... } In the method called when the component is mounted, make the same update. 1 2 3 4 5 6 7 8 //... private _startProgressDemo () : void { // reset the demo this . setState ({ percentComplete : 1 , }); //... } Now comes the tricky part. When you want to properly decrease the progress indicator, you have to calculate the value to decrease from 1 (the initial state, remember ?). This depends on the delay of the countdown. You can add this variable as a private member of the component. 1 2 3 4 5 6 7 8 //... export class ProgressIndicatorBasicExample extends React . Component < {}, IProgressIndicatorBasicExampleState > { private _interval : number ; private _async : Async ; // value = [initial state of ProgressIndicator] / [countdown duration in milliseconds] / [interval of refresh in milliseconds] private _intervalDecrement : number = 1 / COUNTDOWN_DURATION / INTERVAL_DELAY ; //... } We want now to calculate the remaining time of the countdown, to refresh the progress indicator component. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 //... this . _interval = this . _async . setInterval (() => { let percentComplete = this . state . percentComplete - this . _intervalDecrement ; // once 0 reached, set the demo to start again if ( percentComplete <= 0 ) { this . _async . clearInterval ( this . _interval ); this . _async . setTimeout ( this . _startProgressDemo , RESTART_WAIT_TIME ); } this . setState ({ percentComplete : percentComplete , }); }, INTERVAL_DELAY ) Updated code So here is the complete updated code. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 import * as React from 'react' ; import { ProgressIndicator } from 'office-ui-fabric-react/lib/ProgressIndicator' ; import { Async } from 'office-ui-fabric-react/lib/Utilities' ; export interface IProgressIndicatorBasicExampleState { percentComplete : number ; } const INTERVAL_DELAY = 100 ; const COUNTDOWN_DURATION = 30000 ; const RESTART_WAIT_TIME = 2000 ; export class ProgressIndicatorBasicExample extends React . Component < {}, IProgressIndicatorBasicExampleState > { private _interval : number ; private _async : Async ; // value = [initial state of ProgressIndicator] / ([countdown duration in milliseconds] / [interval of refresh in milliseconds]) private _intervalDecrement : number = 1 / ( COUNTDOWN_DURATION / INTERVAL_DELAY ); constructor ( props : {}) { super ( props ); this . _async = new Async ( this ); this . state = { percentComplete : 1 , // --> initial state }; this . _startProgressDemo = this . _startProgressDemo . bind ( this ); } public componentDidMount () : void { this . _startProgressDemo (); } public componentWillUnmount () : void { this . _async . dispose (); } public render () : JSX . Element { const { percentComplete } = this . state ; return ( < ProgressIndicator label = \"Example title\" description = \"Example description\" percentComplete = { percentComplete } /> ); } private _startProgressDemo () : void { // reset the demo this . setState ({ percentComplete : 1 , }); this . _interval = this . _async . setInterval (() => { let percentComplete = this . state . percentComplete - this . _intervalDecrement ; // once 0 reached, set the demo to start again if ( percentComplete <= 0 ) { this . _async . clearInterval ( this . _interval ); this . _async . setTimeout ( this . _startProgressDemo , RESTART_WAIT_TIME ); } this . setState ({ percentComplete : percentComplete , }); }, INTERVAL_DELAY ) } } And that's it! You can find the Codepen example here . Furthermore If you want this control to be reset (for example from a question to another in a session exam), you can turn it into a fully uncontrolled component using a key ! You can also add some text to display the remaining time like this: 1 2 3 4 5 6 7 8 9 10 11 12 //... constructor ( props ) { super ( props ); this . _async = new Async ( this ); this . state = { percentComplete : 1 , timeLeft : COUNTDOWN_DURATION , // --> init timeleft to 30 seconds }; } //... 1 2 3 4 5 6 7 8 9 public render () : JSX . Element { const { percentComplete } = this . state ; return ( < ProgressIndicator label = { `Remaining time : ${ this . state . timeLeft > 0 ? Math . floor ( this . state . timeLeft / 1000 ) : 0 } seconds` } percentComplete = { percentComplete } /> ); } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 //... private _startProgressDemo () : void { // reset the demo this . setState ({ percentComplete : 1 , timeLeft : COUNTDOWN_DURATION , }); this . _interval = this . _async . setInterval (() => { let percentComplete = this . state . percentComplete - this . _intervalDecrement ; let remainingTime = this . state . timeLeft - INTERVAL_DELAY ; // --> update the remaining time // once 0 reached, set the demo to start again if ( percentComplete <= 0 ) { this . _async . clearInterval ( this . _interval ); this . _async . setTimeout ( this . _startProgressDemo , RESTART_WAIT_TIME ); } this . setState ({ percentComplete : percentComplete , timeLeft : remainingTime , }); }, INTERVAL_DELAY ) } Here's the result: You could change the color of the progress indicator component regarding the remaining time and so on... Use your imagination \ud83d\ude09 Happy coding! (Thanks to Charlie B for its help)","title":"[SPFx] Transform the Fluent UI ProgressIndicator  component into a countdown timer"},{"location":"tips/20200505-spfx-progressindicator-to-countdown-timer/#spfx-transform-the-fluent-ui-progressindicator-component-into-a-countdown-timer","text":"Info As you know, the well-know Office UI Fabric front-end infrastructure has been renamed as Fluent UI ! (more info here ) Recently, I had to develop a certification exam with SPFx. One of the features was to provide a countdown within the questions. As I'm familiar with React and the Fluent UI components, I was wondering if it was possible to reuse the ProgressIndicator component and set it up in reverse mode. So here we go !","title":"[SPFx] Transform the Fluent UI ProgressIndicator  component into a countdown timer"},{"location":"tips/20200505-spfx-progressindicator-to-countdown-timer/#existing-sample","text":"First, let's have a look at the sample provided here . 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 import * as React from 'react' ; import { ProgressIndicator } from 'office-ui-fabric-react/lib/ProgressIndicator' ; import { Async } from 'office-ui-fabric-react/lib/Utilities' ; export interface IProgressIndicatorBasicExampleState { percentComplete : number ; } const INTERVAL_DELAY = 100 ; const INTERVAL_INCREMENT = 0.01 ; const RESTART_WAIT_TIME = 2000 ; export class ProgressIndicatorBasicExample extends React . Component < {}, IProgressIndicatorBasicExampleState > { private _interval : number ; private _async : Async ; constructor ( props : {}) { super ( props ); this . _async = new Async ( this ); this . state = { percentComplete : 0 , }; this . _startProgressDemo = this . _startProgressDemo . bind ( this ); } public componentDidMount () : void { this . _startProgressDemo (); } public componentWillUnmount () : void { this . _async . dispose (); } public render () : JSX . Element { const { percentComplete } = this . state ; return ( < ProgressIndicator label = \"Example title\" description = \"Example description\" percentComplete = { percentComplete } /> ); } private _startProgressDemo () : void { // reset the demo this . setState ({ percentComplete : 0 , }); // update progress this . _interval = this . _async . setInterval (() => { let percentComplete = this . state . percentComplete + INTERVAL_INCREMENT ; // once complete, set the demo to start again if ( percentComplete >= 1.0 ) { percentComplete = 1.0 ; this . _async . clearInterval ( this . _interval ); this . _async . setTimeout ( this . _startProgressDemo , RESTART_WAIT_TIME ); } this . setState ({ percentComplete : percentComplete , }); }, INTERVAL_DELAY ); } } This code gives this behavior:","title":"Existing sample"},{"location":"tips/20200505-spfx-progressindicator-to-countdown-timer/#countdown-mode","text":"Now, let's reverse the process. Let's say that you want your countdown set to 30 seconds. You can replace the const variable INTERVAL_INCREMENT (which won't be used anymore) by COUNTDOWN_DURATION . For this demo, the duration will be in milliseconds. 1 2 3 4 5 6 7 8 9 10 11 12 import * as React from 'react' ; import { ProgressIndicator } from 'office-ui-fabric-react/lib/ProgressIndicator' ; import { Async } from 'office-ui-fabric-react/lib/Utilities' ; export interface IProgressIndicatorBasicExampleState { percentComplete : number ; } const INTERVAL_DELAY = 100 ; const COUNTDOWN_DURATION = 30000 ; const RESTART_WAIT_TIME = 2000 ; //... Then, you can set the percentComplete state to 1 in the constructor (remember that this variable is used as a parameter of the component, which goes from 0 to 1). So that the initial state of the Indicator is 1. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 //... export class ProgressIndicatorBasicExample extends React . Component < {}, IProgressIndicatorBasicExampleState > { private _interval : number ; private _async : Async ; constructor ( props : {}) { super ( props ); this . _async = new Async ( this ); this . state = { percentComplete : 1 , // --> initial state }; this . _startProgressDemo = this . _startProgressDemo . bind ( this ); } //... } In the method called when the component is mounted, make the same update. 1 2 3 4 5 6 7 8 //... private _startProgressDemo () : void { // reset the demo this . setState ({ percentComplete : 1 , }); //... } Now comes the tricky part. When you want to properly decrease the progress indicator, you have to calculate the value to decrease from 1 (the initial state, remember ?). This depends on the delay of the countdown. You can add this variable as a private member of the component. 1 2 3 4 5 6 7 8 //... export class ProgressIndicatorBasicExample extends React . Component < {}, IProgressIndicatorBasicExampleState > { private _interval : number ; private _async : Async ; // value = [initial state of ProgressIndicator] / [countdown duration in milliseconds] / [interval of refresh in milliseconds] private _intervalDecrement : number = 1 / COUNTDOWN_DURATION / INTERVAL_DELAY ; //... } We want now to calculate the remaining time of the countdown, to refresh the progress indicator component. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 //... this . _interval = this . _async . setInterval (() => { let percentComplete = this . state . percentComplete - this . _intervalDecrement ; // once 0 reached, set the demo to start again if ( percentComplete <= 0 ) { this . _async . clearInterval ( this . _interval ); this . _async . setTimeout ( this . _startProgressDemo , RESTART_WAIT_TIME ); } this . setState ({ percentComplete : percentComplete , }); }, INTERVAL_DELAY )","title":"Countdown mode"},{"location":"tips/20200505-spfx-progressindicator-to-countdown-timer/#updated-code","text":"So here is the complete updated code. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 import * as React from 'react' ; import { ProgressIndicator } from 'office-ui-fabric-react/lib/ProgressIndicator' ; import { Async } from 'office-ui-fabric-react/lib/Utilities' ; export interface IProgressIndicatorBasicExampleState { percentComplete : number ; } const INTERVAL_DELAY = 100 ; const COUNTDOWN_DURATION = 30000 ; const RESTART_WAIT_TIME = 2000 ; export class ProgressIndicatorBasicExample extends React . Component < {}, IProgressIndicatorBasicExampleState > { private _interval : number ; private _async : Async ; // value = [initial state of ProgressIndicator] / ([countdown duration in milliseconds] / [interval of refresh in milliseconds]) private _intervalDecrement : number = 1 / ( COUNTDOWN_DURATION / INTERVAL_DELAY ); constructor ( props : {}) { super ( props ); this . _async = new Async ( this ); this . state = { percentComplete : 1 , // --> initial state }; this . _startProgressDemo = this . _startProgressDemo . bind ( this ); } public componentDidMount () : void { this . _startProgressDemo (); } public componentWillUnmount () : void { this . _async . dispose (); } public render () : JSX . Element { const { percentComplete } = this . state ; return ( < ProgressIndicator label = \"Example title\" description = \"Example description\" percentComplete = { percentComplete } /> ); } private _startProgressDemo () : void { // reset the demo this . setState ({ percentComplete : 1 , }); this . _interval = this . _async . setInterval (() => { let percentComplete = this . state . percentComplete - this . _intervalDecrement ; // once 0 reached, set the demo to start again if ( percentComplete <= 0 ) { this . _async . clearInterval ( this . _interval ); this . _async . setTimeout ( this . _startProgressDemo , RESTART_WAIT_TIME ); } this . setState ({ percentComplete : percentComplete , }); }, INTERVAL_DELAY ) } } And that's it! You can find the Codepen example here .","title":"Updated code"},{"location":"tips/20200505-spfx-progressindicator-to-countdown-timer/#furthermore","text":"If you want this control to be reset (for example from a question to another in a session exam), you can turn it into a fully uncontrolled component using a key ! You can also add some text to display the remaining time like this: 1 2 3 4 5 6 7 8 9 10 11 12 //... constructor ( props ) { super ( props ); this . _async = new Async ( this ); this . state = { percentComplete : 1 , timeLeft : COUNTDOWN_DURATION , // --> init timeleft to 30 seconds }; } //... 1 2 3 4 5 6 7 8 9 public render () : JSX . Element { const { percentComplete } = this . state ; return ( < ProgressIndicator label = { `Remaining time : ${ this . state . timeLeft > 0 ? Math . floor ( this . state . timeLeft / 1000 ) : 0 } seconds` } percentComplete = { percentComplete } /> ); } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 //... private _startProgressDemo () : void { // reset the demo this . setState ({ percentComplete : 1 , timeLeft : COUNTDOWN_DURATION , }); this . _interval = this . _async . setInterval (() => { let percentComplete = this . state . percentComplete - this . _intervalDecrement ; let remainingTime = this . state . timeLeft - INTERVAL_DELAY ; // --> update the remaining time // once 0 reached, set the demo to start again if ( percentComplete <= 0 ) { this . _async . clearInterval ( this . _interval ); this . _async . setTimeout ( this . _startProgressDemo , RESTART_WAIT_TIME ); } this . setState ({ percentComplete : percentComplete , timeLeft : remainingTime , }); }, INTERVAL_DELAY ) } Here's the result: You could change the color of the progress indicator component regarding the remaining time and so on... Use your imagination \ud83d\ude09 Happy coding! (Thanks to Charlie B for its help)","title":"Furthermore"},{"location":"tips/20201204-spfx-breadcrumb-to-step-indicator/","text":"[SPFx] Transform the Fluent UI Breadcrumb component into a step indicator As I was developing an SPA with a business workflow, I was wondering how to show customers the progression of their requests and how many steps left before the end. So I've been thinking about customizing the Breadcrumb component which is quite flexible to covert my needs. Existing sample Below one of the examples provided in the component page : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 import * as React from 'react' ; import { Breadcrumb , IBreadcrumbItem , IDividerAsProps } from 'office-ui-fabric-react/lib/Breadcrumb' ; import { Label , ILabelStyles } from 'office-ui-fabric-react/lib/Label' ; import { TooltipHost } from 'office-ui-fabric-react/lib/Tooltip' ; import { Icon } from 'office-ui-fabric-react/lib/Icon' ; const labelStyles : Partial < ILabelStyles > = { root : { margin : '10px 0' , selectors : { '&:not(:first-child)' : { marginTop : 24 } } }, }; const itemsWithHeading : IBreadcrumbItem [] = [ { text : 'Files' , key : 'Files' , onClick : _onBreadcrumbItemClicked }, { text : 'Folder 1' , key : 'd1' , onClick : _onBreadcrumbItemClicked }, // Generally, only the last item should ever be a heading. // It would typically be h1 or h2, but we're using h4 here to better fit the structure of the page. { text : 'Folder 2' , key : 'd2' , isCurrentItem : true , as : 'h4' }, ]; export const BreadcrumbBasicExample : React.FunctionComponent = () => { return ( < div > // Other examples < Label styles = { labelStyles } > With custom rendered divider and overflow icon < /Label> < Breadcrumb items = { itemsWithHeading } maxDisplayedItems = { 3 } ariaLabel = \"With custom rendered divider and overflow icon\" dividerAs = { _getCustomDivider } onRenderOverflowIcon = { _getCustomOverflowIcon } overflowAriaLabel = \"More links\" /> < /div> ); }; function _onBreadcrumbItemClicked ( ev : React.MouseEvent < HTMLElement > , item : IBreadcrumbItem ) : void { console . log ( `Breadcrumb item with key \" ${ item . key } \" has been clicked.` ); } function _getCustomDivider ( dividerProps : IDividerAsProps ) : JSX . Element { const tooltipText = dividerProps . item ? dividerProps . item . text : '' ; return ( < TooltipHost content = { `Show ${ tooltipText } contents` } calloutProps = {{ gapSpace : 0 }} > < span aria - hidden = \"true\" style = {{ cursor : 'pointer' , padding : 5 }} > / < /span> < /TooltipHost> ); } function _getCustomOverflowIcon () : JSX . Element { return < Icon iconName = { 'ChevronDown' } /> ; } In this example, we saw that there is a specific separator and a selected item. Now, let's see what can we do to improve this display. Step indicator mode The first thing here is to setup the component as stateless. No... The first thing is to upgrade your SPFx solution to use Fluent UI library instead of Office UI Fabric. So execute npm i @fluentui/react , then execute npm uninstall office-ui-fabric-react . Now, we can work on our component \ud83d\ude01 Just start by adding a folder called \"StepIndicator\", in which you'll register a stateless component and a Sass module, both called \"StepIndicator\". In the tsx file, declare these props : StepIndicator.tsx 1 2 3 4 5 6 7 8 9 10 11 12 import * as React from 'react' ; import styles from './StepIndicator.module.scss' ; import { IBreadcrumbItem } from '@fluentui/react' ; export interface IStepIndicatorProps { currentStep : number ; stepBreadcrumbItems : IBreadcrumbItem []; } export default class StepIndicator extends React . Component < IStepIndicatorProps > { // ... } Like this, you can provide all the steps, including the reached one, in you process. Now, we add two render methods that will manage the display of: Steps ( renderBreadcrumbItem ) Separators / dividers ( renderBreadcrumbDivider ) StepIndicator.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 import * as React from 'react' ; import styles from './StepIndicator.module.scss' ; import { Stack , Breadcrumb , IBreadcrumbItem , Label , IDividerAsProps } from '@fluentui/react' ; export interface IStepIndicatorProps { currentStep : number ; stepBreadcrumbItems : IBreadcrumbItem []; } export default class StepIndicator extends React . Component < IStepIndicatorProps > { public render () : React . ReactElement < IStepIndicatorProps > { return ( < div > { /* TODO : Add Breadcrumb here */ } < /div> ); } private renderBreadcrumbItem = ( item : IBreadcrumbItem ) => { let stepClassName = styles . step ; let currentItemIndex = this . props . stepBreadcrumbItems . indexOf ( item ); let isStepItemReached = currentItemIndex == this . props . currentStep ; // Adapt the display of step whether it was reached or not if ( currentItemIndex <= this . props . currentStep ) { stepClassName = styles . stepvisited ; } return ( < Stack className = { styles . breadcrumbitem } > < Label className = { stepClassName } > { this . props . stepBreadcrumbItems . indexOf ( item ) + 1 } < /Label> < Label className = { isStepItemReached ? styles.statuscurrent : styles.status } > { item . text } < /Label> < /Stack>); } private renderBreadcrumbDivider = ( dividerProps : IDividerAsProps ) => { let separatorClassName = styles . separator ; let currentItemIndex = this . props . stepBreadcrumbItems . indexOf ( dividerProps . item ); // Change the color of the separator, if current step is reached if ( currentItemIndex < this . props . currentStep ) { separatorClassName = styles . separatorvisited ; } return < div className = { separatorClassName } >< /div>; } } Now, we want to setup styles correctly, following the breadcrumb customizations. StepIndicator.module.scss 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 /* /!\\ update the reference to use Fluent UI or you'll get an error */ @ import '~@fluentui/react/dist/sass/References.scss' ; $ bg-color-unreached : $ ms-color-themeLight ; $ bg-color-reached : $ ms-color-themePrimary ; $ font-color-reached : # ffffff ; . stepindicator { /* Style of a step (number and text) */ .breadcrumbitem { width : 150 px ; padding : 0 px 10 px ; /* Style of the text displayed below the step, reached or not */ .status { text-align : center ; font-size : 0.7 rem ; white-space : pre-line ; min-height : 40 px ; &current { @extend .status ; margin-left : -5 px ; font-weight : bold ; } } /* Style of the step 'icon' (number) Here, it's displayed as a circle */ . step { border-radius : 50 % ; height : 26 px ; width : 26 px ; line-height : 26 px ; font-size : 1 rem ; text-align : center ; padding : 0 px ; left : 40 % ; position : relative ; background-color : $ bg-color-unreached ; z-index : 1 ; &visited { @extend .step ; color : $ font - color - reached ; background-color : $ bg-color-reached ; } } } /* Style of the divider */ . separator { display : inline-block ; position : absolute ; content : '' ; height : 4 px ; width : 95 % ; top : 17 % ; left : 55 % ; background-color : $ bg-color-unreached ; &visited { @extend .separator ; background-color : $ bg-color-reached ; } } } After that, we just have to reference the Breadcrumb component which will use our declared methods and styling StepIndicator.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 import * as React from 'react' ; import styles from './StepIndicator.module.scss' ; import { Stack , Breadcrumb , IBreadcrumbItem , Label , IDividerAsProps , IBreadcrumbData } from '@fluentui/react' ; // ... export default class StepIndicator extends React . Component < IStepIndicatorProps > { public render () : React . ReactElement < IStepIndicatorProps > { return ( < Stack className = { styles . stepindicator } horizontalAlign = \"center\" > < Breadcrumb onReduceData = { this . _reduceBreadcrumbData } onRenderItem = { this . _renderBreadcrumbItem } dividerAs = { this . _renderBreadcrumbDivider } items = { this . props . stepBreadcrumbItems } /> < /Stack> ); } private _reduceBreadcrumbData = ( data : IBreadcrumbData ) => { return undefined ; } // ... } For this sample, I set the onReduceData to not shrink the component because I want to show every step. Full sample So here is the complete sample. HelloWorld.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 import { Dropdown , IDropdownOption , Stack } from '@fluentui/react' ; import * as React from 'react' ; import StepIndicator from '../StepIndicator' ; import styles from './HelloWorld.module.scss' ; import { IHelloWorldProps } from './IHelloWorldProps' ; interface IHelloWorldState { selectedStatusIndex : number ; } export default class HelloWorld extends React . Component < IHelloWorldProps , IHelloWorldState > { public constructor ( props ) { super ( props ); this . state = { selectedStatusIndex : 0 , }; } // For this example, I'll use this property for both Breadcrumb items and DropDown options private _steps : any [] = [ { key : 'init' , text : 'Create purchase order' }, { key : 'select' , text : 'Analyze & select vendor' }, { key : 'negociate' , text : 'Negociate contract' }, { key : 'pay' , text : 'Authorize & pay vendor' }, { key : 'end' , text : 'Done' } ]; public render () : React . ReactElement < IHelloWorldProps > { return ( < div className = { styles . helloWorld } > < div className = { styles . container } > < div className = { styles . row } > < div className = { styles . column } > < span className = { styles . title } > Welcome to SharePoint !< /span> < p className = { styles . subTitle } > Customize SharePoint experiences using Web Parts . < /p> < p className = { styles . description } > { escape ( this . props . description )} < /p> < a href = \"https://aka.ms/spfx\" className = { styles . button } > < span className = { styles . label } > Learn more < /span> < /a> < /div> < /div> < Stack tokens = {{ padding : '10px' }} > < StepIndicator currentStep = { this . state . selectedStatusIndex } stepBreadcrumbItems = { this . _steps } /> < /Stack> < Stack tokens = {{ padding : '10px' , maxWidth : '300px' }} > < Dropdown label = \"Select process step\" options = { this . _steps } defaultSelectedKey = 'init' onChange = { this . _dropDownStepOnChange } /> < /Stack> < /div> < /div> ); } private _dropDownStepOnChange = ( event : React.FormEvent < HTMLDivElement > , option? : IDropdownOption , index? : number ) => { this . setState ({ selectedStatusIndex : index , }); } } StepIndicator.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 import * as React from 'react' ; import styles from './StepIndicator.module.scss' ; import { Stack , Breadcrumb , IBreadcrumbItem , Label , IDividerAsProps , IBreadcrumbData } from '@fluentui/react' ; export interface IStepIndicatorProps { currentStep : number ; stepBreadcrumbItems : IBreadcrumbItem []; } export default class StepIndicator extends React . Component < IStepIndicatorProps > { public render () : React . ReactElement < IStepIndicatorProps > { return ( < Stack className = { styles . stepindicator } horizontalAlign = \"center\" > < Breadcrumb onReduceData = { this . _reduceBreadcrumbData } onRenderItem = { this . _renderBreadcrumbItem } dividerAs = { this . _renderBreadcrumbDivider } items = { this . props . stepBreadcrumbItems } /> < /Stack> ); } private _reduceBreadcrumbData = ( data : IBreadcrumbData ) => { return undefined ; } private _renderBreadcrumbItem = ( item : IBreadcrumbItem ) => { let stepClassName = styles . step ; let currentItemIndex = this . props . stepBreadcrumbItems . indexOf ( item ); let isStepItemReached = currentItemIndex == this . props . currentStep ; if ( currentItemIndex <= this . props . currentStep ) { stepClassName = styles . stepvisited ; } return ( < Stack className = { styles . breadcrumbitem } > < Label className = { stepClassName } > { this . props . stepBreadcrumbItems . indexOf ( item ) + 1 } < /Label> < Label className = { isStepItemReached ? styles.statuscurrent : styles.status } > { item . text } < /Label> < /Stack>); } private _renderBreadcrumbDivider = ( dividerProps : IDividerAsProps ) => { let separatorClassName = styles . separator ; let currentItemIndex = this . props . stepBreadcrumbItems . indexOf ( dividerProps . item ); if ( currentItemIndex < this . props . currentStep ) { separatorClassName = styles . separatorvisited ; } return < div className = { separatorClassName } >< /div>; } } StepIndicator.module.scss 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 /* /!\\ update the reference to use Fluent UI or you'll get an error */ @ import '~@fluentui/react/dist/sass/References.scss' ; $ bg-color-unreached : $ ms-color-themeLight ; $ bg-color-reached : $ ms-color-themePrimary ; $ font-color-reached : # ffffff ; . stepindicator { /* Style of a step (number and text) */ .breadcrumbitem { width : 150 px ; padding : 0 px 10 px ; /* Style of the text displayed below the step, reached or not */ .status { text-align : center ; font-size : 0.7 rem ; white-space : pre-line ; min-height : 40 px ; &current { @extend .status ; margin-left : -5 px ; font-weight : bold ; } } /* Style of the step 'icon' (number) Here, it's displayed as a circle */ . step { border-radius : 50 % ; height : 26 px ; width : 26 px ; line-height : 26 px ; font-size : 1 rem ; text-align : center ; padding : 0 px ; left : 40 % ; position : relative ; background-color : $ bg-color-unreached ; z-index : 1 ; &visited { @extend .step ; color : $ font - color - reached ; background-color : $ bg-color-reached ; } } } /* Style of the divider */ . separator { display : inline-block ; position : absolute ; content : '' ; height : 4 px ; width : 95 % ; top : 17 % ; left : 55 % ; background-color : $ bg-color-unreached ; &visited { @extend .separator ; background-color : $ bg-color-reached ; } } } And the result: Happy coding !","title":"[SPFx] Transform the Fluent UI Breadcrumb component into a step indicator"},{"location":"tips/20201204-spfx-breadcrumb-to-step-indicator/#spfx-transform-the-fluent-ui-breadcrumb-component-into-a-step-indicator","text":"As I was developing an SPA with a business workflow, I was wondering how to show customers the progression of their requests and how many steps left before the end. So I've been thinking about customizing the Breadcrumb component which is quite flexible to covert my needs.","title":"[SPFx] Transform the Fluent UI Breadcrumb component into a step indicator"},{"location":"tips/20201204-spfx-breadcrumb-to-step-indicator/#existing-sample","text":"Below one of the examples provided in the component page : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 import * as React from 'react' ; import { Breadcrumb , IBreadcrumbItem , IDividerAsProps } from 'office-ui-fabric-react/lib/Breadcrumb' ; import { Label , ILabelStyles } from 'office-ui-fabric-react/lib/Label' ; import { TooltipHost } from 'office-ui-fabric-react/lib/Tooltip' ; import { Icon } from 'office-ui-fabric-react/lib/Icon' ; const labelStyles : Partial < ILabelStyles > = { root : { margin : '10px 0' , selectors : { '&:not(:first-child)' : { marginTop : 24 } } }, }; const itemsWithHeading : IBreadcrumbItem [] = [ { text : 'Files' , key : 'Files' , onClick : _onBreadcrumbItemClicked }, { text : 'Folder 1' , key : 'd1' , onClick : _onBreadcrumbItemClicked }, // Generally, only the last item should ever be a heading. // It would typically be h1 or h2, but we're using h4 here to better fit the structure of the page. { text : 'Folder 2' , key : 'd2' , isCurrentItem : true , as : 'h4' }, ]; export const BreadcrumbBasicExample : React.FunctionComponent = () => { return ( < div > // Other examples < Label styles = { labelStyles } > With custom rendered divider and overflow icon < /Label> < Breadcrumb items = { itemsWithHeading } maxDisplayedItems = { 3 } ariaLabel = \"With custom rendered divider and overflow icon\" dividerAs = { _getCustomDivider } onRenderOverflowIcon = { _getCustomOverflowIcon } overflowAriaLabel = \"More links\" /> < /div> ); }; function _onBreadcrumbItemClicked ( ev : React.MouseEvent < HTMLElement > , item : IBreadcrumbItem ) : void { console . log ( `Breadcrumb item with key \" ${ item . key } \" has been clicked.` ); } function _getCustomDivider ( dividerProps : IDividerAsProps ) : JSX . Element { const tooltipText = dividerProps . item ? dividerProps . item . text : '' ; return ( < TooltipHost content = { `Show ${ tooltipText } contents` } calloutProps = {{ gapSpace : 0 }} > < span aria - hidden = \"true\" style = {{ cursor : 'pointer' , padding : 5 }} > / < /span> < /TooltipHost> ); } function _getCustomOverflowIcon () : JSX . Element { return < Icon iconName = { 'ChevronDown' } /> ; } In this example, we saw that there is a specific separator and a selected item. Now, let's see what can we do to improve this display.","title":"Existing sample"},{"location":"tips/20201204-spfx-breadcrumb-to-step-indicator/#step-indicator-mode","text":"The first thing here is to setup the component as stateless. No... The first thing is to upgrade your SPFx solution to use Fluent UI library instead of Office UI Fabric. So execute npm i @fluentui/react , then execute npm uninstall office-ui-fabric-react . Now, we can work on our component \ud83d\ude01 Just start by adding a folder called \"StepIndicator\", in which you'll register a stateless component and a Sass module, both called \"StepIndicator\". In the tsx file, declare these props : StepIndicator.tsx 1 2 3 4 5 6 7 8 9 10 11 12 import * as React from 'react' ; import styles from './StepIndicator.module.scss' ; import { IBreadcrumbItem } from '@fluentui/react' ; export interface IStepIndicatorProps { currentStep : number ; stepBreadcrumbItems : IBreadcrumbItem []; } export default class StepIndicator extends React . Component < IStepIndicatorProps > { // ... } Like this, you can provide all the steps, including the reached one, in you process. Now, we add two render methods that will manage the display of: Steps ( renderBreadcrumbItem ) Separators / dividers ( renderBreadcrumbDivider ) StepIndicator.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 import * as React from 'react' ; import styles from './StepIndicator.module.scss' ; import { Stack , Breadcrumb , IBreadcrumbItem , Label , IDividerAsProps } from '@fluentui/react' ; export interface IStepIndicatorProps { currentStep : number ; stepBreadcrumbItems : IBreadcrumbItem []; } export default class StepIndicator extends React . Component < IStepIndicatorProps > { public render () : React . ReactElement < IStepIndicatorProps > { return ( < div > { /* TODO : Add Breadcrumb here */ } < /div> ); } private renderBreadcrumbItem = ( item : IBreadcrumbItem ) => { let stepClassName = styles . step ; let currentItemIndex = this . props . stepBreadcrumbItems . indexOf ( item ); let isStepItemReached = currentItemIndex == this . props . currentStep ; // Adapt the display of step whether it was reached or not if ( currentItemIndex <= this . props . currentStep ) { stepClassName = styles . stepvisited ; } return ( < Stack className = { styles . breadcrumbitem } > < Label className = { stepClassName } > { this . props . stepBreadcrumbItems . indexOf ( item ) + 1 } < /Label> < Label className = { isStepItemReached ? styles.statuscurrent : styles.status } > { item . text } < /Label> < /Stack>); } private renderBreadcrumbDivider = ( dividerProps : IDividerAsProps ) => { let separatorClassName = styles . separator ; let currentItemIndex = this . props . stepBreadcrumbItems . indexOf ( dividerProps . item ); // Change the color of the separator, if current step is reached if ( currentItemIndex < this . props . currentStep ) { separatorClassName = styles . separatorvisited ; } return < div className = { separatorClassName } >< /div>; } } Now, we want to setup styles correctly, following the breadcrumb customizations. StepIndicator.module.scss 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 /* /!\\ update the reference to use Fluent UI or you'll get an error */ @ import '~@fluentui/react/dist/sass/References.scss' ; $ bg-color-unreached : $ ms-color-themeLight ; $ bg-color-reached : $ ms-color-themePrimary ; $ font-color-reached : # ffffff ; . stepindicator { /* Style of a step (number and text) */ .breadcrumbitem { width : 150 px ; padding : 0 px 10 px ; /* Style of the text displayed below the step, reached or not */ .status { text-align : center ; font-size : 0.7 rem ; white-space : pre-line ; min-height : 40 px ; &current { @extend .status ; margin-left : -5 px ; font-weight : bold ; } } /* Style of the step 'icon' (number) Here, it's displayed as a circle */ . step { border-radius : 50 % ; height : 26 px ; width : 26 px ; line-height : 26 px ; font-size : 1 rem ; text-align : center ; padding : 0 px ; left : 40 % ; position : relative ; background-color : $ bg-color-unreached ; z-index : 1 ; &visited { @extend .step ; color : $ font - color - reached ; background-color : $ bg-color-reached ; } } } /* Style of the divider */ . separator { display : inline-block ; position : absolute ; content : '' ; height : 4 px ; width : 95 % ; top : 17 % ; left : 55 % ; background-color : $ bg-color-unreached ; &visited { @extend .separator ; background-color : $ bg-color-reached ; } } } After that, we just have to reference the Breadcrumb component which will use our declared methods and styling StepIndicator.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 import * as React from 'react' ; import styles from './StepIndicator.module.scss' ; import { Stack , Breadcrumb , IBreadcrumbItem , Label , IDividerAsProps , IBreadcrumbData } from '@fluentui/react' ; // ... export default class StepIndicator extends React . Component < IStepIndicatorProps > { public render () : React . ReactElement < IStepIndicatorProps > { return ( < Stack className = { styles . stepindicator } horizontalAlign = \"center\" > < Breadcrumb onReduceData = { this . _reduceBreadcrumbData } onRenderItem = { this . _renderBreadcrumbItem } dividerAs = { this . _renderBreadcrumbDivider } items = { this . props . stepBreadcrumbItems } /> < /Stack> ); } private _reduceBreadcrumbData = ( data : IBreadcrumbData ) => { return undefined ; } // ... } For this sample, I set the onReduceData to not shrink the component because I want to show every step.","title":"Step indicator mode"},{"location":"tips/20201204-spfx-breadcrumb-to-step-indicator/#full-sample","text":"So here is the complete sample. HelloWorld.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 import { Dropdown , IDropdownOption , Stack } from '@fluentui/react' ; import * as React from 'react' ; import StepIndicator from '../StepIndicator' ; import styles from './HelloWorld.module.scss' ; import { IHelloWorldProps } from './IHelloWorldProps' ; interface IHelloWorldState { selectedStatusIndex : number ; } export default class HelloWorld extends React . Component < IHelloWorldProps , IHelloWorldState > { public constructor ( props ) { super ( props ); this . state = { selectedStatusIndex : 0 , }; } // For this example, I'll use this property for both Breadcrumb items and DropDown options private _steps : any [] = [ { key : 'init' , text : 'Create purchase order' }, { key : 'select' , text : 'Analyze & select vendor' }, { key : 'negociate' , text : 'Negociate contract' }, { key : 'pay' , text : 'Authorize & pay vendor' }, { key : 'end' , text : 'Done' } ]; public render () : React . ReactElement < IHelloWorldProps > { return ( < div className = { styles . helloWorld } > < div className = { styles . container } > < div className = { styles . row } > < div className = { styles . column } > < span className = { styles . title } > Welcome to SharePoint !< /span> < p className = { styles . subTitle } > Customize SharePoint experiences using Web Parts . < /p> < p className = { styles . description } > { escape ( this . props . description )} < /p> < a href = \"https://aka.ms/spfx\" className = { styles . button } > < span className = { styles . label } > Learn more < /span> < /a> < /div> < /div> < Stack tokens = {{ padding : '10px' }} > < StepIndicator currentStep = { this . state . selectedStatusIndex } stepBreadcrumbItems = { this . _steps } /> < /Stack> < Stack tokens = {{ padding : '10px' , maxWidth : '300px' }} > < Dropdown label = \"Select process step\" options = { this . _steps } defaultSelectedKey = 'init' onChange = { this . _dropDownStepOnChange } /> < /Stack> < /div> < /div> ); } private _dropDownStepOnChange = ( event : React.FormEvent < HTMLDivElement > , option? : IDropdownOption , index? : number ) => { this . setState ({ selectedStatusIndex : index , }); } } StepIndicator.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 import * as React from 'react' ; import styles from './StepIndicator.module.scss' ; import { Stack , Breadcrumb , IBreadcrumbItem , Label , IDividerAsProps , IBreadcrumbData } from '@fluentui/react' ; export interface IStepIndicatorProps { currentStep : number ; stepBreadcrumbItems : IBreadcrumbItem []; } export default class StepIndicator extends React . Component < IStepIndicatorProps > { public render () : React . ReactElement < IStepIndicatorProps > { return ( < Stack className = { styles . stepindicator } horizontalAlign = \"center\" > < Breadcrumb onReduceData = { this . _reduceBreadcrumbData } onRenderItem = { this . _renderBreadcrumbItem } dividerAs = { this . _renderBreadcrumbDivider } items = { this . props . stepBreadcrumbItems } /> < /Stack> ); } private _reduceBreadcrumbData = ( data : IBreadcrumbData ) => { return undefined ; } private _renderBreadcrumbItem = ( item : IBreadcrumbItem ) => { let stepClassName = styles . step ; let currentItemIndex = this . props . stepBreadcrumbItems . indexOf ( item ); let isStepItemReached = currentItemIndex == this . props . currentStep ; if ( currentItemIndex <= this . props . currentStep ) { stepClassName = styles . stepvisited ; } return ( < Stack className = { styles . breadcrumbitem } > < Label className = { stepClassName } > { this . props . stepBreadcrumbItems . indexOf ( item ) + 1 } < /Label> < Label className = { isStepItemReached ? styles.statuscurrent : styles.status } > { item . text } < /Label> < /Stack>); } private _renderBreadcrumbDivider = ( dividerProps : IDividerAsProps ) => { let separatorClassName = styles . separator ; let currentItemIndex = this . props . stepBreadcrumbItems . indexOf ( dividerProps . item ); if ( currentItemIndex < this . props . currentStep ) { separatorClassName = styles . separatorvisited ; } return < div className = { separatorClassName } >< /div>; } } StepIndicator.module.scss 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 /* /!\\ update the reference to use Fluent UI or you'll get an error */ @ import '~@fluentui/react/dist/sass/References.scss' ; $ bg-color-unreached : $ ms-color-themeLight ; $ bg-color-reached : $ ms-color-themePrimary ; $ font-color-reached : # ffffff ; . stepindicator { /* Style of a step (number and text) */ .breadcrumbitem { width : 150 px ; padding : 0 px 10 px ; /* Style of the text displayed below the step, reached or not */ .status { text-align : center ; font-size : 0.7 rem ; white-space : pre-line ; min-height : 40 px ; &current { @extend .status ; margin-left : -5 px ; font-weight : bold ; } } /* Style of the step 'icon' (number) Here, it's displayed as a circle */ . step { border-radius : 50 % ; height : 26 px ; width : 26 px ; line-height : 26 px ; font-size : 1 rem ; text-align : center ; padding : 0 px ; left : 40 % ; position : relative ; background-color : $ bg-color-unreached ; z-index : 1 ; &visited { @extend .step ; color : $ font - color - reached ; background-color : $ bg-color-reached ; } } } /* Style of the divider */ . separator { display : inline-block ; position : absolute ; content : '' ; height : 4 px ; width : 95 % ; top : 17 % ; left : 55 % ; background-color : $ bg-color-unreached ; &visited { @extend .separator ; background-color : $ bg-color-reached ; } } } And the result: Happy coding !","title":"Full sample"},{"location":"tips/20210302-spfx-api-permissions/","text":"[SPFx] Init API permissions for your SPFx projects without deploying them When developing your SPFx components, you usually first run them locally before deploying them (really ?). And then comes the time to work with API such as Microsoft Graph. If you never use those permissions before in your SPFx projects (and the tenant with which you're working), you realize that you have to: Add required API permissions in your package-solution.json file Bundle / Ship your project Publish it Go to the SharePoint Admin Center Web API Permissions page Approve those permissions All of this, just to play with the API as you didn't plan to release your package in a production environment. So what if you could bypass all these steps for both Graph and owned API? Important This trick is just for development purposes. In Production environment, you should update your package-solution.json file to add required permissions and allow them (or ask for validation) in the API access page. Prerequisites An Office 365 (Dev) Tenant or a Partner Demo Tenant The following Azure AD role at least Application Administrator With Graph API First, we're going to play with Graph API through the Microsoft Graph Toolkit . Prepare your sample Init a SPFx project (WebPart one with React, let's call it HelloApi ), then add the Microsoft Graph Toolkit by executing npm i @microsoft/mgt @microsoft/mgt-react from the project's root path. Once done, open your main component file (let's say here HelloApi.tsx ) and add the PeoplePicker component like this: HelloApi.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 import * as React from 'react' ; import styles from './HelloApi.module.scss' ; import { IHelloApiProps } from './IHelloApiProps' ; import { escape } from '@microsoft/sp-lodash-subset' ; import { PeoplePicker } from '@microsoft/mgt-react' ; export default class HelloApi extends React . Component < IHelloApiProps , {} > { public render () : React . ReactElement < IHelloApiProps > { return ( < div className = { styles . HelloApi } > < div className = { styles . container } > < div className = { styles . row } > < div className = { styles . column } > < span className = { styles . title } > Welcome to SharePoint !< /span> < p className = { styles . subTitle } > Customize SharePoint experiences using Web Parts . < /p> < p className = { styles . description } > { escape ( this . props . description )} < /p> < a href = \"https://aka.ms/spfx\" className = { styles . button } > < span className = { styles . label } > Learn more < /span> < /a> < /div> < /div> < /div> < PeoplePicker /> < /div> ); } } Run it in remote workbench Now run your sample with gulp serve and display your webpart in your remote workbench ( https://contoso.sharepoint.com/_layouts/15/workbench.aspx ). Try to use the PeoplePicker component: you'll see that just by clicking on the search box, you'll get We didn't find any matches . Display your developer toolbox (F12) and go to the browser console, you should see the following error: As you can see, it's a 403 error, which is well-known when using Graph API endpoints that have not been allowed on the first place. Add Graph API through UI From the Azure portal, display the Azure Active Directory (AAD), then select the App Registration menu and select All Applications , then click on SharePoint Online Client Extensibility Web Application Principal . It's the AAD Application that holds the connection to the API (Microsoft and others) from SharePoint (SPFx or every other development) using the Implicit Flow . Once here, click on Add a permission , then select Microsoft Graph and add the [ People.Read ] Graph API delegated permission (you can type the name of the permission in the available search box to get it easily). Once added, grant it by clicking on Grant admin consent for contoso . If you go in the API access page ( https://contoso-admin.sharepoint.com/_layouts/15/online/AdminHome.aspx#/webApiPermissionManagement ), you should see something like this: (other Graph API permissions displayed here won't be necessary for the sample) Warning It can take a couple of minutes before consented permissions is effective, so don't be surprised if it's not working right away after approval. Add Graph API through CLI for Microsoft 365 1 2 m365 login # Don't execute that command if you're already connected m365 spo serviceprincipal grant add --resource 'Microsoft Graph' --scope 'People.Read' Info Don't be surprised if by that way, the permission appears in the \"Other permissions granted for [your tenant]\": it won't prevent your SPFx solution to work. Try again Now try to use the PeoplePicker component again: you'll see that with the addition of the Graph API permission, you should be able to use that component! With custom API When using a custom API, it's a little bit more tricky but easy to handle anyway. You can follow this Microsoft article until the \"Deploy the solution\" part. Instead of bundling and shipping, we'll add the AAD App (called contoso-api-dp20200915 if we follow the mentioned article) created from the Azure Function Authentication part in the SharePoint Service Principal. Add your AAD Application to the SharePoint Service Principal Display again the AAD page, then select the App Registration menu, select All Applications and click on SharePoint Online Client Extensibility Web Application Principal . Once here, click on Add a permission , then select the My APIs tab and select the fresh added AAD App created before. Select the user_impersonation permission, then confirm. Finally, grant this permission by clicking on Grant admin consent for contoso . If you go again in the API access page, you should see something like this: Add custom API through CLI for Microsoft 365 1 2 m365 login # Don't execute that command if you're already connected m365 spo serviceprincipal grant add --resource 'contoso-api-dp20200915' --scope 'user_impersonation' Info Don't be surprised if by that way, the permission appears in the \"Other permissions granted for [your tenant]\": it won't prevent your SPFx solution to work. Warning If you use an Azure Function as an API and enable Managed Identity for any reason, you better have to rename the linked AAD Application to give it a different name than both your Function and its Managed Identity . Otherwise, the command will try to find a scope on it instead of the AAD App and fail. Updated sample To run your custom API from your SPFx component, you can update your sample like below: IHelloApiProps.ts 1 2 3 4 5 6 import { AadHttpClientFactory } from '@microsoft/sp-http' ; export interface IHelloApiProps { aadFactory : AadHttpClientFactory ; description : string ; } HelloApiWebPart.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // ... export default class HelloApiWebPart extends BaseClientSideWebPart < IHelloApiWebPartProps > { // ... public render () : void { const element : React.ReactElement < IHelloApiProps > = React . createElement ( HelloGraph , { description : this.properties.description , aadFactory : this.context.aadHttpClientFactory , } ); ReactDom . render ( element , this . domElement ); } // ... } HelloApi.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 import * as React from 'react' ; import styles from './HelloApi.module.scss' ; import { IHelloApiProps } from './IHelloApiProps' ; import { AadHttpClient , HttpClientResponse } from '@microsoft/sp-http' ; interface IHelloApiState { ordersToDisplay : any ; } export default class HelloApi extends React . Component < IHelloApiProps , IHelloApiState > { public constructor ( props ) { super ( props ); this . state = { ordersToDisplay : null }; } public componentDidMount () { this . props . aadFactory . getClient ( 'https://contoso-api-dp20191109.azurewebsites.net' ) . then (( client : AadHttpClient ) : void => { client . get ( 'https://contoso-api-dp20191109.azurewebsites.net/api/Orders' , AadHttpClient . configurations . v1 ) . then (( response : HttpClientResponse ) : Promise < any > => { return response . json (); }) . then (( orders : any ) : void => { this . setState ({ ordersToDisplay : orders }) }); }). catch (( err ) => { console . log ( err ); }); } public render () : React . ReactElement < IHelloApiProps > { return ( < div className = { styles . HelloApi } > < div className = { styles . container } > < div className = { styles . row } > < div className = { styles . column } > < span className = { styles . title } > Welcome to SharePoint !< /span> < p className = { styles . subTitle } > Customize SharePoint experiences using Web Parts . < /p> < p className = { styles . description } > < ul > { this . state . ordersToDisplay && this . state . ordersToDisplay . map ( o => { return < li > { o . rep } : { o . total } < /li> }) } < /ul> < /p> < /div> < /div> < /div> < /div> ); } } Now you can run your sample locally and try it in your hosted workbench, playing with it and updating your WebPart as you want! ... And don't forget to update your package-solution.json file to include the required APIs before shipping! \ud83d\ude43 Happy coding!","title":"[SPFx] Init API permissions for your SPFx projects without deploying them"},{"location":"tips/20210302-spfx-api-permissions/#spfx-init-api-permissions-for-your-spfx-projects-without-deploying-them","text":"When developing your SPFx components, you usually first run them locally before deploying them (really ?). And then comes the time to work with API such as Microsoft Graph. If you never use those permissions before in your SPFx projects (and the tenant with which you're working), you realize that you have to: Add required API permissions in your package-solution.json file Bundle / Ship your project Publish it Go to the SharePoint Admin Center Web API Permissions page Approve those permissions All of this, just to play with the API as you didn't plan to release your package in a production environment. So what if you could bypass all these steps for both Graph and owned API? Important This trick is just for development purposes. In Production environment, you should update your package-solution.json file to add required permissions and allow them (or ask for validation) in the API access page.","title":"[SPFx] Init API permissions for your SPFx projects without deploying them"},{"location":"tips/20210302-spfx-api-permissions/#prerequisites","text":"An Office 365 (Dev) Tenant or a Partner Demo Tenant The following Azure AD role at least Application Administrator","title":"Prerequisites"},{"location":"tips/20210302-spfx-api-permissions/#with-graph-api","text":"First, we're going to play with Graph API through the Microsoft Graph Toolkit .","title":"With Graph API"},{"location":"tips/20210302-spfx-api-permissions/#prepare-your-sample","text":"Init a SPFx project (WebPart one with React, let's call it HelloApi ), then add the Microsoft Graph Toolkit by executing npm i @microsoft/mgt @microsoft/mgt-react from the project's root path. Once done, open your main component file (let's say here HelloApi.tsx ) and add the PeoplePicker component like this: HelloApi.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 import * as React from 'react' ; import styles from './HelloApi.module.scss' ; import { IHelloApiProps } from './IHelloApiProps' ; import { escape } from '@microsoft/sp-lodash-subset' ; import { PeoplePicker } from '@microsoft/mgt-react' ; export default class HelloApi extends React . Component < IHelloApiProps , {} > { public render () : React . ReactElement < IHelloApiProps > { return ( < div className = { styles . HelloApi } > < div className = { styles . container } > < div className = { styles . row } > < div className = { styles . column } > < span className = { styles . title } > Welcome to SharePoint !< /span> < p className = { styles . subTitle } > Customize SharePoint experiences using Web Parts . < /p> < p className = { styles . description } > { escape ( this . props . description )} < /p> < a href = \"https://aka.ms/spfx\" className = { styles . button } > < span className = { styles . label } > Learn more < /span> < /a> < /div> < /div> < /div> < PeoplePicker /> < /div> ); } }","title":"Prepare your sample"},{"location":"tips/20210302-spfx-api-permissions/#run-it-in-remote-workbench","text":"Now run your sample with gulp serve and display your webpart in your remote workbench ( https://contoso.sharepoint.com/_layouts/15/workbench.aspx ). Try to use the PeoplePicker component: you'll see that just by clicking on the search box, you'll get We didn't find any matches . Display your developer toolbox (F12) and go to the browser console, you should see the following error: As you can see, it's a 403 error, which is well-known when using Graph API endpoints that have not been allowed on the first place.","title":"Run it in remote workbench"},{"location":"tips/20210302-spfx-api-permissions/#add-graph-api-through-ui","text":"From the Azure portal, display the Azure Active Directory (AAD), then select the App Registration menu and select All Applications , then click on SharePoint Online Client Extensibility Web Application Principal . It's the AAD Application that holds the connection to the API (Microsoft and others) from SharePoint (SPFx or every other development) using the Implicit Flow . Once here, click on Add a permission , then select Microsoft Graph and add the [ People.Read ] Graph API delegated permission (you can type the name of the permission in the available search box to get it easily). Once added, grant it by clicking on Grant admin consent for contoso . If you go in the API access page ( https://contoso-admin.sharepoint.com/_layouts/15/online/AdminHome.aspx#/webApiPermissionManagement ), you should see something like this: (other Graph API permissions displayed here won't be necessary for the sample) Warning It can take a couple of minutes before consented permissions is effective, so don't be surprised if it's not working right away after approval.","title":"Add Graph API through UI"},{"location":"tips/20210302-spfx-api-permissions/#add-graph-api-through-cli-for-microsoft-365","text":"1 2 m365 login # Don't execute that command if you're already connected m365 spo serviceprincipal grant add --resource 'Microsoft Graph' --scope 'People.Read' Info Don't be surprised if by that way, the permission appears in the \"Other permissions granted for [your tenant]\": it won't prevent your SPFx solution to work.","title":"Add Graph API through CLI for Microsoft 365"},{"location":"tips/20210302-spfx-api-permissions/#try-again","text":"Now try to use the PeoplePicker component again: you'll see that with the addition of the Graph API permission, you should be able to use that component!","title":"Try again"},{"location":"tips/20210302-spfx-api-permissions/#with-custom-api","text":"When using a custom API, it's a little bit more tricky but easy to handle anyway. You can follow this Microsoft article until the \"Deploy the solution\" part. Instead of bundling and shipping, we'll add the AAD App (called contoso-api-dp20200915 if we follow the mentioned article) created from the Azure Function Authentication part in the SharePoint Service Principal.","title":"With custom API"},{"location":"tips/20210302-spfx-api-permissions/#add-your-aad-application-to-the-sharepoint-service-principal","text":"Display again the AAD page, then select the App Registration menu, select All Applications and click on SharePoint Online Client Extensibility Web Application Principal . Once here, click on Add a permission , then select the My APIs tab and select the fresh added AAD App created before. Select the user_impersonation permission, then confirm. Finally, grant this permission by clicking on Grant admin consent for contoso . If you go again in the API access page, you should see something like this:","title":"Add your AAD Application to the SharePoint Service Principal"},{"location":"tips/20210302-spfx-api-permissions/#add-custom-api-through-cli-for-microsoft-365","text":"1 2 m365 login # Don't execute that command if you're already connected m365 spo serviceprincipal grant add --resource 'contoso-api-dp20200915' --scope 'user_impersonation' Info Don't be surprised if by that way, the permission appears in the \"Other permissions granted for [your tenant]\": it won't prevent your SPFx solution to work. Warning If you use an Azure Function as an API and enable Managed Identity for any reason, you better have to rename the linked AAD Application to give it a different name than both your Function and its Managed Identity . Otherwise, the command will try to find a scope on it instead of the AAD App and fail.","title":"Add custom API through CLI for Microsoft 365"},{"location":"tips/20210302-spfx-api-permissions/#updated-sample","text":"To run your custom API from your SPFx component, you can update your sample like below: IHelloApiProps.ts 1 2 3 4 5 6 import { AadHttpClientFactory } from '@microsoft/sp-http' ; export interface IHelloApiProps { aadFactory : AadHttpClientFactory ; description : string ; } HelloApiWebPart.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // ... export default class HelloApiWebPart extends BaseClientSideWebPart < IHelloApiWebPartProps > { // ... public render () : void { const element : React.ReactElement < IHelloApiProps > = React . createElement ( HelloGraph , { description : this.properties.description , aadFactory : this.context.aadHttpClientFactory , } ); ReactDom . render ( element , this . domElement ); } // ... } HelloApi.tsx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 import * as React from 'react' ; import styles from './HelloApi.module.scss' ; import { IHelloApiProps } from './IHelloApiProps' ; import { AadHttpClient , HttpClientResponse } from '@microsoft/sp-http' ; interface IHelloApiState { ordersToDisplay : any ; } export default class HelloApi extends React . Component < IHelloApiProps , IHelloApiState > { public constructor ( props ) { super ( props ); this . state = { ordersToDisplay : null }; } public componentDidMount () { this . props . aadFactory . getClient ( 'https://contoso-api-dp20191109.azurewebsites.net' ) . then (( client : AadHttpClient ) : void => { client . get ( 'https://contoso-api-dp20191109.azurewebsites.net/api/Orders' , AadHttpClient . configurations . v1 ) . then (( response : HttpClientResponse ) : Promise < any > => { return response . json (); }) . then (( orders : any ) : void => { this . setState ({ ordersToDisplay : orders }) }); }). catch (( err ) => { console . log ( err ); }); } public render () : React . ReactElement < IHelloApiProps > { return ( < div className = { styles . HelloApi } > < div className = { styles . container } > < div className = { styles . row } > < div className = { styles . column } > < span className = { styles . title } > Welcome to SharePoint !< /span> < p className = { styles . subTitle } > Customize SharePoint experiences using Web Parts . < /p> < p className = { styles . description } > < ul > { this . state . ordersToDisplay && this . state . ordersToDisplay . map ( o => { return < li > { o . rep } : { o . total } < /li> }) } < /ul> < /p> < /div> < /div> < /div> < /div> ); } } Now you can run your sample locally and try it in your hosted workbench, playing with it and updating your WebPart as you want! ... And don't forget to update your package-solution.json file to include the required APIs before shipping! \ud83d\ude43 Happy coding!","title":"Updated sample"},{"location":"tips/20210914-azdo-project-admin-members-programmatically/","text":"[Azure DevOps] Get default project administrators team members programmatically When working on Projects organization in Azure DevOps (AzDO), you want to establish governance and maybe get some reporting data. Among all parameters available, you have some default ones such as the Project Administrator team, which is provided when you create a new project. If you didn't have the \"chance\" to work with AzDO API, it's not as fluent as some other Microsoft's API like Graph or Azure ones (and I'm not talking about the .NET Client Libraries for which PRs are still pending to provide updates on methods). And in that case, getting that default team's members requires some \"jumps\" from an API to another to get this info. Let's have a look about this! In this article, I'll show you how to get what you came for, with REST API and .NET Client Libraries. Important In this article, I'll focus on the online version of Azure DevOps (aka Services) not Server or TFS. Prerequisites An AzDO organization (you can create one with any Microsoft account here ), with at least one existing Project The following AzDO permission level at least member of the default project team which is available in the Project's settings, on the \"Teams\" page For querying the AzDO services using .NET Client Libraries, you'll need to create a Personal Access Token (PAT) with at least the following scopes: Graph: Read Identity: Read Member Entitlement Management: Read Project and Team: Read Querying the AzDO REST API The first thing you have to know is that there's not one service / domain URL for the API. Below a short list of some URLs: https://dev.azure.com , if you want to query most of AzDO endpoints such as /_apis/git or /_apis/projects https://vsaex.dev.azure.com , if you want to query the Member Entitlement Management endpoints such as /_apis/groupentitlements https://vssps.dev.azure.com , if you want to query endpoints related to people / groups, like /_apis/identities or /_apis/graph/groups https://status.dev.azure.com , if you want to query the AzDO /_apis/status endpoint I couldn't find anything on the web about the meaning / reason why it's cut on pieces like this. My guess is that, depending on what you are querying, the info is on a server or another. So beware when you are jumping from an endpoint to another: you could face a 404 error page when the problem is just that the service / domain URL is not the right one. To get default project team members, we will proceed in the following order: Getting Project's ID Getting Project's scope descriptor value Getting Project's groups (with the scope descriptor value obtained before) Getting default Project Administrators members As all the queries will use the GET method, we'll use the browser (be sure to be authenticated in your AzDO Organization before). Project ID that's the simpliest one (here the {project_name} would be \"My Project\"): https://dev.azure.com/{org}/_apis/projects/{project_name} 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 { \"id\" : \"40865cf2-d252-49dc-874f-294aa1d9ad9f\" , // < --- Take t his id \"name\" : \"{project_name}\" , \"description\" : \"Test project\" , \"url\" : \"https://dev.azure.com/{org}/_apis/projects/40865cf2-d252-49dc-874f-294aa1d9ad9f\" , \"state\" : \"wellFormed\" , \"revision\" : 35 , \"_links\" : { \"self\" : { \"href\" : \"https://dev.azure.com/{org}/_apis/projects/40865cf2-d252-49dc-874f-294aa1d9ad9f\" }, \"collection\" : { \"href\" : \"https://dev.azure.com/{org}/_apis/projectCollections/11321932-248d-4b22-a9ee-efddaaf6930e\" }, \"web\" : { \"href\" : \"https://dev.azure.com/{org}/{project_name}\" } }, \"visibility\" : \"private\" , \"defaultTeam\" : { \"id\" : \"50fb2515-f8e8-4c4f-b786-54bfdd17ebf0\" , \"name\" : \"Test project Team\" , \"url\" : \"https://dev.azure.com/{org}/_apis/projects/408*65cf2-d252-49dc-874f-294aa1d9ad9f/teams/50fb2515-f8e8-4c4f-b786-54bfdd17ebf0\" }, \"lastUpdateTime\" : \"2019-11-05T13:25:37.617Z\" } Project's scope descriptor value Let's switch to another service (here the {project_id} would be \"40865cf2-d252-49dc-874f-294aa1d9ad9f\"): https://vssps.dev.azure.com/{org}/_apis/graph/descriptors/{project_id} 1 2 3 4 5 6 7 8 9 10 11 12 13 14 { \"value\" : \"scp.ODRiNmMwNjMtMTRiNS00ZGUyLWE4YjgtNmFmOWZmZDNiNjdm\" , // < --- Take t his value \"_links\" : { \"self\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Descriptors/{project_id}\" }, \"storageKey\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/StorageKeys/scp.ODRiNmMwNjMtMTRiNS00ZGUyLWE4YjgtNmFmOWZmZDNiNjdm\" }, \"subject\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Scopes/scp.ODRiNmMwNjMtMTRiNS00ZGUyLWE4YjgtNmFmOWZmZDNiNjdm\" } } } Project's groups with the scope descriptor value With the value obtained before (here the {project_scope_descriptor} would be \"scp.ODRiNmMwNjMtMTRiNS00ZGUyLWE4YjgtNmFmOWZmZDNiNjdm\"): https://vssps.dev.azure.com/{org}/_apis/graph/groups?scopeDescriptor={project_scope_descriptor} 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 { \"count\" : 9 , \"value\" : [ { \"subjectKind\" : \"group\" , \"description\" : \"Members of this group can perform all operations in the team project.\" , \"domain\" : \"vstfs:///Classification/TeamProject/{project_id}\" , \"principalName\" : \"[Test project]\\\\Project Administrators\" , \"mailAddress\" : null , \"origin\" : \"vsts\" , \"originId\" : \"95cf6f67-22a5-41ca-92a0-435f7a8eb948\" , // < --- Take t his id \"displayName\" : \"Project Administrators\" , \"_links\" : { \"self\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Groups/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" }, \"memberships\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Memberships/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" }, \"membershipState\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/MembershipStates/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" }, \"storageKey\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/StorageKeys/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" } }, \"url\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Groups/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" , \"descriptor\" : \"vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" } // .... ] } The cool thing about this group is that it's created by AzDO and has only read-only properties, so you can look for the \"Project Administrators\" display name without being worried about title changing. Getting default Project Administrators members Finally, with the Project Team ID through the originId property, get the members (and switch to another service URL, where the {project_team_id} would be \"95cf6f67-22a5-41ca-92a0-435f7a8eb948\"): https://vsaex.dev.azure.com/{org}/_apis/GroupEntitlements/{project_team_id}/members 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 { \"members\" : [ { \"id\" : \"8b8948a8-a17a-60c5-8fb9-39985bbef603\" , \"user\" : { \"subjectKind\" : \"user\" , \"metaType\" : \"member\" , \"directoryAlias\" : \"meganb\" , \"domain\" : \"1fdd85e0-9a94-4593-8ab0-5ad1b834475f\" , \"principalName\" : \"meganb@contoso.onmicrosoft.com\" , \"mailAddress\" : \"meganb@contoso.onmicrosoft.com\" , \"origin\" : \"aad\" , \"originId\" : \"1bec3bfc-8fec-41a9-b408-f1b4fcf9aa52\" , \"displayName\" : \"Megan Bowen\" , \"_links\" : { \"self\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Users/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"memberships\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Memberships/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"membershipState\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/MembershipStates/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"storageKey\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/StorageKeys/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"avatar\" : { \"href\" : \"https://dev.azure.com/{org}/_apis/GraphProfile/MemberAvatars/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" } }, \"url\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Users/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" , \"descriptor\" : \"aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"accessLevel\" : { \"licensingSource\" : \"account\" , \"accountLicenseType\" : \"stakeholder\" , \"msdnLicenseType\" : \"none\" , \"licenseDisplayName\" : \"Stakeholder\" , \"status\" : \"active\" , \"statusMessage\" : \"\" , \"assignmentSource\" : \"unknown\" }, \"lastAccessedDate\" : \"2021-09-08T10:22:13.8704588Z\" , \"dateCreated\" : \"2019-07-23T13:51:52.953Z\" , \"projectEntitlements\" : [], \"extensions\" : [], \"groupAssignments\" : [] } ], \"continuationToken\" : \"aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" , \"totalCount\" : -1 , \"items\" : [ { \"id\" : \"8b8948a8-a17a-60c5-8fb9-39985bbef603\" , \"user\" : { \"subjectKind\" : \"user\" , \"metaType\" : \"member\" , \"directoryAlias\" : \"meganb\" , \"domain\" : \"1fdd85e0-9a94-4593-8ab0-5ad1b834475f\" , \"principalName\" : \"meganb@contoso.onmicrosoft.com\" , \"mailAddress\" : \"meganb@contoso.onmicrosoft.com\" , \"origin\" : \"aad\" , \"originId\" : \"1bec3bfc-8fec-41a9-b408-f1b4fcf9aa52\" , \"displayName\" : \"Megan Bowen\" , \"_links\" : { \"self\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Users/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"memberships\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Memberships/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"membershipState\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/MembershipStates/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"storageKey\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/StorageKeys/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"avatar\" : { \"href\" : \"https://dev.azure.com/{org}/_apis/GraphProfile/MemberAvatars/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" } }, \"url\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Users/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" , \"descriptor\" : \"aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"accessLevel\" : { \"licensingSource\" : \"account\" , \"accountLicenseType\" : \"stakeholder\" , \"msdnLicenseType\" : \"none\" , \"licenseDisplayName\" : \"Stakeholder\" , \"status\" : \"active\" , \"statusMessage\" : \"\" , \"assignmentSource\" : \"unknown\" }, \"lastAccessedDate\" : \"2021-09-08T10:22:13.8704588Z\" , \"dateCreated\" : \"2019-07-23T13:51:52.953Z\" , \"projectEntitlements\" : [], \"extensions\" : [], \"groupAssignments\" : [] } ] } Why not using the /_api/teams endpoint I realized that when your Organization has many Projects, you can waste some time to find the specific Project Administrators Team, as this endpoint doesn't provide query filters and works with paging. With this approach, you're sure to get to your Project's specific team. Using the .NET Client Libraries You'll need to install the following Nuget packages: Microsoft.TeamFoundationServer.Client Microsoft.VisualStudio.Services.Client Microsoft.VisualStudio.Services.MemberEntitlementManagement.WebApi Below the complete console app code snippet (including authentication with a Personal Access Token / PAT). ConsoleAppAzDO.cs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 using Microsoft.TeamFoundation.Core.WebApi ; using Microsoft.VisualStudio.Services.Common ; using Microsoft.VisualStudio.Services.Graph.Client ; using Microsoft.VisualStudio.Services.MemberEntitlementManagement.WebApi ; using Microsoft.VisualStudio.Services.WebApi ; using System ; using System.Collections.Generic ; using System.Linq ; namespace ConsoleAppAzDO { public class Program { public static void Main ( string [] args ) { string orgnizationUrl = \"contoso\" ; string personalAccessToken = \"[YOUR_PAT]\" ; string projectName = \"My Project\" ; // Authenticate to AzDO with a Personal Access Token Uri url = new Uri ( \"https://dev.azure.com/\" + orgnizationUrl ); VssCredentials credentials = new VssBasicCredential ( \"pat\" , personalAccessToken ); VssConnection connection = new VssConnection ( url , credentials ); // Get client contexts (in order to run queries) ProjectHttpClient projectCtx = connection . GetClient < ProjectHttpClient >(); GraphHttpClient graphCtx = connection . GetClient < GraphHttpClient >(); MemberEntitlementManagementHttpClient memberCtx = connection . GetClient < MemberEntitlementManagementHttpClient >(); // Get project info TeamProject myProject = projectCtx . GetProject ( projectName ). Result ; // Get project descriptor GraphDescriptorResult myProjectDescriptor = graphCtx . GetDescriptorAsync ( myProject . Id ). Result ; // Get all project's groups PagedGraphGroups myProjectGroups = graphCtx . ListGroupsAsync ( myProjectDescriptor . Value . ToString ()). Result ; // Get default project administrators group GraphGroup myProjectAdmins = myProjectGroups . GraphGroups . Where ( gp => gp . PrincipalName . Contains ( \"Project Administrators\" ) && gp . DisplayName == \"Project Administrators\" ). FirstOrDefault (); // Get group members List < GraphUser > myProjectAdminUsers = memberCtx . GetGroupMembersAsync ( new Guid ( myProjectAdmins . OriginId )). Result . Members . Select ( mem => mem . User ). ToList (); // Display admin members myProjectAdminUsers . ForEach ( user => Console . WriteLine ( user . DisplayName )); } } } Of course, you can go further into handling AzDO data. But you'll have to be patient and curious to get what you want, and eventually you'll have to query directly the REST API, because the .NET Client library won't provide what you expect \ud83d\udc40 Happy coding! Useful Links Azure DevOps REST API .NET Client Libraries .NET Client Libraries samples","title":"[Azure DevOps] Get default project administrators team members programmatically"},{"location":"tips/20210914-azdo-project-admin-members-programmatically/#azure-devops-get-default-project-administrators-team-members-programmatically","text":"When working on Projects organization in Azure DevOps (AzDO), you want to establish governance and maybe get some reporting data. Among all parameters available, you have some default ones such as the Project Administrator team, which is provided when you create a new project. If you didn't have the \"chance\" to work with AzDO API, it's not as fluent as some other Microsoft's API like Graph or Azure ones (and I'm not talking about the .NET Client Libraries for which PRs are still pending to provide updates on methods). And in that case, getting that default team's members requires some \"jumps\" from an API to another to get this info. Let's have a look about this! In this article, I'll show you how to get what you came for, with REST API and .NET Client Libraries. Important In this article, I'll focus on the online version of Azure DevOps (aka Services) not Server or TFS.","title":"[Azure DevOps] Get default project administrators team members programmatically"},{"location":"tips/20210914-azdo-project-admin-members-programmatically/#prerequisites","text":"An AzDO organization (you can create one with any Microsoft account here ), with at least one existing Project The following AzDO permission level at least member of the default project team which is available in the Project's settings, on the \"Teams\" page For querying the AzDO services using .NET Client Libraries, you'll need to create a Personal Access Token (PAT) with at least the following scopes: Graph: Read Identity: Read Member Entitlement Management: Read Project and Team: Read","title":"Prerequisites"},{"location":"tips/20210914-azdo-project-admin-members-programmatically/#querying-the-azdo-rest-api","text":"The first thing you have to know is that there's not one service / domain URL for the API. Below a short list of some URLs: https://dev.azure.com , if you want to query most of AzDO endpoints such as /_apis/git or /_apis/projects https://vsaex.dev.azure.com , if you want to query the Member Entitlement Management endpoints such as /_apis/groupentitlements https://vssps.dev.azure.com , if you want to query endpoints related to people / groups, like /_apis/identities or /_apis/graph/groups https://status.dev.azure.com , if you want to query the AzDO /_apis/status endpoint I couldn't find anything on the web about the meaning / reason why it's cut on pieces like this. My guess is that, depending on what you are querying, the info is on a server or another. So beware when you are jumping from an endpoint to another: you could face a 404 error page when the problem is just that the service / domain URL is not the right one. To get default project team members, we will proceed in the following order: Getting Project's ID Getting Project's scope descriptor value Getting Project's groups (with the scope descriptor value obtained before) Getting default Project Administrators members As all the queries will use the GET method, we'll use the browser (be sure to be authenticated in your AzDO Organization before).","title":"Querying the AzDO REST API"},{"location":"tips/20210914-azdo-project-admin-members-programmatically/#project-id","text":"that's the simpliest one (here the {project_name} would be \"My Project\"): https://dev.azure.com/{org}/_apis/projects/{project_name} 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 { \"id\" : \"40865cf2-d252-49dc-874f-294aa1d9ad9f\" , // < --- Take t his id \"name\" : \"{project_name}\" , \"description\" : \"Test project\" , \"url\" : \"https://dev.azure.com/{org}/_apis/projects/40865cf2-d252-49dc-874f-294aa1d9ad9f\" , \"state\" : \"wellFormed\" , \"revision\" : 35 , \"_links\" : { \"self\" : { \"href\" : \"https://dev.azure.com/{org}/_apis/projects/40865cf2-d252-49dc-874f-294aa1d9ad9f\" }, \"collection\" : { \"href\" : \"https://dev.azure.com/{org}/_apis/projectCollections/11321932-248d-4b22-a9ee-efddaaf6930e\" }, \"web\" : { \"href\" : \"https://dev.azure.com/{org}/{project_name}\" } }, \"visibility\" : \"private\" , \"defaultTeam\" : { \"id\" : \"50fb2515-f8e8-4c4f-b786-54bfdd17ebf0\" , \"name\" : \"Test project Team\" , \"url\" : \"https://dev.azure.com/{org}/_apis/projects/408*65cf2-d252-49dc-874f-294aa1d9ad9f/teams/50fb2515-f8e8-4c4f-b786-54bfdd17ebf0\" }, \"lastUpdateTime\" : \"2019-11-05T13:25:37.617Z\" }","title":"Project ID"},{"location":"tips/20210914-azdo-project-admin-members-programmatically/#projects-scope-descriptor-value","text":"Let's switch to another service (here the {project_id} would be \"40865cf2-d252-49dc-874f-294aa1d9ad9f\"): https://vssps.dev.azure.com/{org}/_apis/graph/descriptors/{project_id} 1 2 3 4 5 6 7 8 9 10 11 12 13 14 { \"value\" : \"scp.ODRiNmMwNjMtMTRiNS00ZGUyLWE4YjgtNmFmOWZmZDNiNjdm\" , // < --- Take t his value \"_links\" : { \"self\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Descriptors/{project_id}\" }, \"storageKey\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/StorageKeys/scp.ODRiNmMwNjMtMTRiNS00ZGUyLWE4YjgtNmFmOWZmZDNiNjdm\" }, \"subject\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Scopes/scp.ODRiNmMwNjMtMTRiNS00ZGUyLWE4YjgtNmFmOWZmZDNiNjdm\" } } }","title":"Project's scope descriptor value"},{"location":"tips/20210914-azdo-project-admin-members-programmatically/#projects-groups-with-the-scope-descriptor-value","text":"With the value obtained before (here the {project_scope_descriptor} would be \"scp.ODRiNmMwNjMtMTRiNS00ZGUyLWE4YjgtNmFmOWZmZDNiNjdm\"): https://vssps.dev.azure.com/{org}/_apis/graph/groups?scopeDescriptor={project_scope_descriptor} 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 { \"count\" : 9 , \"value\" : [ { \"subjectKind\" : \"group\" , \"description\" : \"Members of this group can perform all operations in the team project.\" , \"domain\" : \"vstfs:///Classification/TeamProject/{project_id}\" , \"principalName\" : \"[Test project]\\\\Project Administrators\" , \"mailAddress\" : null , \"origin\" : \"vsts\" , \"originId\" : \"95cf6f67-22a5-41ca-92a0-435f7a8eb948\" , // < --- Take t his id \"displayName\" : \"Project Administrators\" , \"_links\" : { \"self\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Groups/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" }, \"memberships\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Memberships/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" }, \"membershipState\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/MembershipStates/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" }, \"storageKey\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/StorageKeys/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" } }, \"url\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Groups/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" , \"descriptor\" : \"vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNjczNTc0MDIwLTMwMzgwNDQ3NDktMjgzMDY1ODI5Ny00MjkyMDY0ODk1LTAtMC0wLTAtMQ\" } // .... ] } The cool thing about this group is that it's created by AzDO and has only read-only properties, so you can look for the \"Project Administrators\" display name without being worried about title changing.","title":"Project's groups with the scope descriptor value"},{"location":"tips/20210914-azdo-project-admin-members-programmatically/#getting-default-project-administrators-members","text":"Finally, with the Project Team ID through the originId property, get the members (and switch to another service URL, where the {project_team_id} would be \"95cf6f67-22a5-41ca-92a0-435f7a8eb948\"): https://vsaex.dev.azure.com/{org}/_apis/GroupEntitlements/{project_team_id}/members 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 { \"members\" : [ { \"id\" : \"8b8948a8-a17a-60c5-8fb9-39985bbef603\" , \"user\" : { \"subjectKind\" : \"user\" , \"metaType\" : \"member\" , \"directoryAlias\" : \"meganb\" , \"domain\" : \"1fdd85e0-9a94-4593-8ab0-5ad1b834475f\" , \"principalName\" : \"meganb@contoso.onmicrosoft.com\" , \"mailAddress\" : \"meganb@contoso.onmicrosoft.com\" , \"origin\" : \"aad\" , \"originId\" : \"1bec3bfc-8fec-41a9-b408-f1b4fcf9aa52\" , \"displayName\" : \"Megan Bowen\" , \"_links\" : { \"self\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Users/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"memberships\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Memberships/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"membershipState\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/MembershipStates/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"storageKey\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/StorageKeys/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"avatar\" : { \"href\" : \"https://dev.azure.com/{org}/_apis/GraphProfile/MemberAvatars/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" } }, \"url\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Users/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" , \"descriptor\" : \"aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"accessLevel\" : { \"licensingSource\" : \"account\" , \"accountLicenseType\" : \"stakeholder\" , \"msdnLicenseType\" : \"none\" , \"licenseDisplayName\" : \"Stakeholder\" , \"status\" : \"active\" , \"statusMessage\" : \"\" , \"assignmentSource\" : \"unknown\" }, \"lastAccessedDate\" : \"2021-09-08T10:22:13.8704588Z\" , \"dateCreated\" : \"2019-07-23T13:51:52.953Z\" , \"projectEntitlements\" : [], \"extensions\" : [], \"groupAssignments\" : [] } ], \"continuationToken\" : \"aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" , \"totalCount\" : -1 , \"items\" : [ { \"id\" : \"8b8948a8-a17a-60c5-8fb9-39985bbef603\" , \"user\" : { \"subjectKind\" : \"user\" , \"metaType\" : \"member\" , \"directoryAlias\" : \"meganb\" , \"domain\" : \"1fdd85e0-9a94-4593-8ab0-5ad1b834475f\" , \"principalName\" : \"meganb@contoso.onmicrosoft.com\" , \"mailAddress\" : \"meganb@contoso.onmicrosoft.com\" , \"origin\" : \"aad\" , \"originId\" : \"1bec3bfc-8fec-41a9-b408-f1b4fcf9aa52\" , \"displayName\" : \"Megan Bowen\" , \"_links\" : { \"self\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Users/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"memberships\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Memberships/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"membershipState\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/MembershipStates/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"storageKey\" : { \"href\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/StorageKeys/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"avatar\" : { \"href\" : \"https://dev.azure.com/{org}/_apis/GraphProfile/MemberAvatars/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" } }, \"url\" : \"https://vssps.dev.azure.com/{org}/_apis/Graph/Users/aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" , \"descriptor\" : \"aad.OGI4OTQ4YTgtYTE3YS03MGM1LThmYjktMzk5ODViYmVmNjAz\" }, \"accessLevel\" : { \"licensingSource\" : \"account\" , \"accountLicenseType\" : \"stakeholder\" , \"msdnLicenseType\" : \"none\" , \"licenseDisplayName\" : \"Stakeholder\" , \"status\" : \"active\" , \"statusMessage\" : \"\" , \"assignmentSource\" : \"unknown\" }, \"lastAccessedDate\" : \"2021-09-08T10:22:13.8704588Z\" , \"dateCreated\" : \"2019-07-23T13:51:52.953Z\" , \"projectEntitlements\" : [], \"extensions\" : [], \"groupAssignments\" : [] } ] }","title":"Getting default Project Administrators members"},{"location":"tips/20210914-azdo-project-admin-members-programmatically/#why-not-using-the-_apiteams-endpoint","text":"I realized that when your Organization has many Projects, you can waste some time to find the specific Project Administrators Team, as this endpoint doesn't provide query filters and works with paging. With this approach, you're sure to get to your Project's specific team.","title":"Why not using the /_api/teams endpoint"},{"location":"tips/20210914-azdo-project-admin-members-programmatically/#using-the-net-client-libraries","text":"You'll need to install the following Nuget packages: Microsoft.TeamFoundationServer.Client Microsoft.VisualStudio.Services.Client Microsoft.VisualStudio.Services.MemberEntitlementManagement.WebApi Below the complete console app code snippet (including authentication with a Personal Access Token / PAT). ConsoleAppAzDO.cs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 using Microsoft.TeamFoundation.Core.WebApi ; using Microsoft.VisualStudio.Services.Common ; using Microsoft.VisualStudio.Services.Graph.Client ; using Microsoft.VisualStudio.Services.MemberEntitlementManagement.WebApi ; using Microsoft.VisualStudio.Services.WebApi ; using System ; using System.Collections.Generic ; using System.Linq ; namespace ConsoleAppAzDO { public class Program { public static void Main ( string [] args ) { string orgnizationUrl = \"contoso\" ; string personalAccessToken = \"[YOUR_PAT]\" ; string projectName = \"My Project\" ; // Authenticate to AzDO with a Personal Access Token Uri url = new Uri ( \"https://dev.azure.com/\" + orgnizationUrl ); VssCredentials credentials = new VssBasicCredential ( \"pat\" , personalAccessToken ); VssConnection connection = new VssConnection ( url , credentials ); // Get client contexts (in order to run queries) ProjectHttpClient projectCtx = connection . GetClient < ProjectHttpClient >(); GraphHttpClient graphCtx = connection . GetClient < GraphHttpClient >(); MemberEntitlementManagementHttpClient memberCtx = connection . GetClient < MemberEntitlementManagementHttpClient >(); // Get project info TeamProject myProject = projectCtx . GetProject ( projectName ). Result ; // Get project descriptor GraphDescriptorResult myProjectDescriptor = graphCtx . GetDescriptorAsync ( myProject . Id ). Result ; // Get all project's groups PagedGraphGroups myProjectGroups = graphCtx . ListGroupsAsync ( myProjectDescriptor . Value . ToString ()). Result ; // Get default project administrators group GraphGroup myProjectAdmins = myProjectGroups . GraphGroups . Where ( gp => gp . PrincipalName . Contains ( \"Project Administrators\" ) && gp . DisplayName == \"Project Administrators\" ). FirstOrDefault (); // Get group members List < GraphUser > myProjectAdminUsers = memberCtx . GetGroupMembersAsync ( new Guid ( myProjectAdmins . OriginId )). Result . Members . Select ( mem => mem . User ). ToList (); // Display admin members myProjectAdminUsers . ForEach ( user => Console . WriteLine ( user . DisplayName )); } } } Of course, you can go further into handling AzDO data. But you'll have to be patient and curious to get what you want, and eventually you'll have to query directly the REST API, because the .NET Client library won't provide what you expect \ud83d\udc40 Happy coding!","title":"Using the .NET Client Libraries"},{"location":"tips/20210914-azdo-project-admin-members-programmatically/#useful-links","text":"Azure DevOps REST API .NET Client Libraries .NET Client Libraries samples","title":"Useful Links"}]}